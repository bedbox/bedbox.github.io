<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Codes Online">
<meta property="og:url" content="http://51codes.top/page/9/index.html">
<meta property="og:site_name" content="Codes Online">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Codes Online">






  <link rel="canonical" href="http://51codes.top/page/9/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Codes Online</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Codes Online</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _enjoying</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/26/spring/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/26/spring/" itemprop="url">
                  Spring原理：IOC和AOP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-26 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-26T23:47:44+08:00">2017-10-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 13:12:52" itemprop="dateModified" datetime="2017-11-11T13:12:52+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>说是Java web，Spring已经成为了事实标准，Spring原理的深入学习，无论是在工作中，还是在面试中，都尤为重要。</p>
<p>Spring的两个核心概念是IOC（控制反转）和AOP（面向切面编程）。想了解Spring的工作原理，毫无疑问，首先要从这两个概念的Spring实现入手。但是Spring源码浩如烟海，里面掺杂了太多的实现细节，入门可谓极其困难。当我正苦于难以入门时，好友介绍了<a href="https://github.com/code4craft/tiny-spring" target="_blank" rel="external">tiny-spring</a>这个开源项目，这个项目用了不到千行的代码，就将Spring的IOC、AOP的核心流程实现完毕，真是居家旅行、吹逼面试之必备呀！</p>
<p>废话少说，我们开始吧！</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>在github上clone下项目来之后，我们关注src文件夹，其余的是一些爱好者提的注释PR，恰巧被作者merge了，不必理会。目录结构是这样的：</p>
<p><img src="/2017/10/26/spring/1.png" alt=""></p>
<p>1- aop包，顾名思义，实现了Spring的AOP功能，可以通过bean的自动AOP切入，文件稍多，暂时先不展开。</p>
<p>2- bean.factory包，通过BeanFactory、AbstractBeanFactory、AutowireCapableBeanFactory三个类，实现了BeanFactory的核心功能，详情稍后讲解。</p>
<p>3- bean.io包定义了资源加载相关的抽象概念，这里的资源包括xml配置文件等。</p>
<p>4- bean.xml包中只包含一个类：XmlBeanDefinitionReader，主要负责在xml配置文件中读取bean定义。</p>
<p>5- bean包其他类，定义了BeanDefinition等核心概念，详情后讲。</p>
<p>6- context包定义了ApplicationContext的核心概念。</p>
<p>7- BeanReference指的是引用类型的Bean，而不是实体类。</p>
<h3 id="IOC–浮沙筑台之根基"><a href="#IOC–浮沙筑台之根基" class="headerlink" title="IOC–浮沙筑台之根基"></a>IOC–浮沙筑台之根基</h3><p>IOC（控制翻转）是一种编程范式，可以在一定程度上解决复杂系统对象耦合度太高的问题，并不是Spring的专利。IOC最常见的方式是DI（依赖注入），可以通过一个容器，将Bean维护起来，方便在其他地方直接使用，而不是重新new。可以说，IOC是Spring最基本的概念，没有IOC就没有Spring。</p>
<p>为什么DI可以起到解耦的作用？</p>
<p>一个软件系统包含了大量的对象，每个对象之间都有依赖关系，在普通的软件编写过程中，对象的定义分布在各个文件之中，对象之间的依赖，只能通过类的构造器传参，方法传参的形式来完成。当工程变大之后，复杂的逻辑会让对象之间的依赖梳理变得异常困难。</p>
<p>在Spring IOC中，一般情况，我们可以在XML文件之中，统一的编写bean的定义，bean与bean之间的依赖关系，从而增加逻辑的清晰度。而且，bean的创建是由Spring来完成的，不需要编程人员关心，编程人员只需要将精力放到业务的逻辑上面，减轻了思维的负担。</p>
<p>在tiny-spring里面，整个beans和context包都是用来实现IOC的。</p>
<p>beans包实现的核心关注点是BeanFactory，BeanFactory也叫作Bean容器，顾名思义，是用来盛放、管理bean的。</p>
<p>context包实现的核心关注是ApplicationContext，ApplicationContext也是用来获取Bean的，但是它更高层，它的面向用户是Spring的使用者，而BeanFactory面向的用户更多是Spring开发者。BeanFactory定义了Bean初始化的流程，ApplicationContext定义了从XML读取，到Bean初始化，再到使用的过程。</p>
<h3 id="Bean在哪定义？"><a href="#Bean在哪定义？" class="headerlink" title="Bean在哪定义？"></a>Bean在哪定义？</h3><p>刚才有说到，Spring通常通过xml文件，来统一的描述bean，bean与bean的依赖关系。所以说，bean的定义表述，发生在xml配置文件之中。这个XML文件就是我们需要读取的资源文件。</p>
<p>因此，首要任务就是研究与读取XML资源文件相关的类。</p>
<p>bean.io中存放的是读取资源文件的抽象概念。其中包含了三个类或者接口：</p>
<p>1- Resource接口，这个接口只有一个方法，InputStream getInputStream() throws IOException;。实现这个接口的类就是一个抽象的资源，可以获取这个资源的输入流，从而获取其中的内容。</p>
<p>2- UrlResource类，这个类实现了Resource接口，通过构造器传入一个url地址，代表的是这个url所对应的文件。</p>
<p>3- ResourceLoader类，只有一个方法，public Resource getResource(String location)。输入url的文件地址（并不是真正的URL格式地址），来获取Resource。</p>
<p>通过分析上面三个类、接口，我们知道，这个包完成了一个任务：通过ResourceLoader这个类，获取某一个地址的Resource，从而获取这个文件的输入流。因为使用了Resource概念，可以使用网络文件或者本地文件。</p>
<h3 id="Bean如何定义？"><a href="#Bean如何定义？" class="headerlink" title="Bean如何定义？"></a>Bean如何定义？</h3><p>1- BeanDefinition是Bean定义的核心概念，BeanDefinition包含了：bean的对象、bean的类类型、bean的名字，bean的所有属性。这个类对bean的基本信息做好一个包装。</p>
<p>2- BeanDefinitionReader接口，只有一个方法：void loadBeanDefinitions(String location) throws Exception;，实现这个接口的类，具有将某一个文件中的所有bean定义载入的功能。所以BeanDefinitionReader定义了，在哪载入bean定义，至于载入到哪里、如何载入，稍后看具体实现。</p>
<p>3- AbstractBeanDefinitionReader抽象类，上面刚说了实现了BeanDefinitionReader接口的类，具有将某一个文件中描述的bean定义载入的功能，AbstractBeanDefinitionReader就实现了这样一个抽象功能。它的作用就是定义，载入到哪和如何载入的问题。在这个类里面，有两个属性：Map registry;和ResourceLoader resourceLoader;。registry是一个注册表，他保存的就是所有的Bean定义，Map结构，key是bean的名字，value就是BeanDefinition。resourceLoader描述了如何载入。</p>
<p>4- XmlBeanDefinitionReader这是beans.xml包里面的唯一一个方法，也是最重要的方法之一。它继承了AbstractBeanDefinitionReader，实现了所有方法，解决了bean定义中：在哪载入、如何载入、载入到哪的三个大问题。这个类面向用户的方法有两个，一个是loadBeanDefinitions，毫无疑问，这个是必须的。另一个是getRegistry用来获取bean注册表，得到所有bean的信息，registry是bean们在内存中实际的家。但是这个getRegistry方法并不是面向用户的，而是面向ApplicationContext的。</p>
<p>5- PropertyValue和PropertyValue代表一种抽象概念，在xml中，bean的属性包括属性名和属性对象，PropertyValue就是这么一个实体。</p>
<p>6- BeanReference代表的是Bean的属性不是真实对象，而是另一个bean的引用。</p>
<h3 id="Bean的组装全过程"><a href="#Bean的组装全过程" class="headerlink" title="Bean的组装全过程"></a>Bean的组装全过程</h3><p>上面两部分是铺垫，而BeanFactory才是重点对象。beans.factory包中有三个类用来定义BeanFactory相关的概念。</p>
<p>1- BeanFactory接口，只有一个方法：Object getBean(String name) throws Exception;，实现这个接口的类，就具有了得到一个bean的能力。</p>
<p>2- AbstractBeanFactory类，较为复杂。详情后讲。</p>
<p>3- AutowireCapableBeanFactory继承了AbstractBeanFactory，实现了applyPropertyValues方法，通过反射，将bean的所有属性，通过set方法注入进去。</p>
<p>AbstractBeanFactory有三大属性：</p>
<p>beanDefinitionMap，类似于registry，但是他是BeanFactory里面私有的，代表的是这个BeanFactory里面暂时有哪些bean定义。<br>beanDefinitionNames代表里面，这个BeanFactory里面有哪些bean（名字）。</p>
<p>beanPostProcessors，代理处理器，AOP会用到，详情后讲。</p>
<p>AbstractBeanFactory实现了几大功能：</p>
<p>getBean，这是主要功能，可以获取一个Bean对象。</p>
<p>registerBeanDefinition，面向ApplicationContext，用来将XML配置文件里面的bean定义注册到BeanFactory里面。</p>
<p>preInstantiateSingletons，面向ApplicationContext，用来在开始的时候，将所有的bean都初始化完毕，避免懒加载。</p>
<p>addBeanPostProcessor添加代理处理器。</p>
<p>getBeansForType，在BeanFactory里面，获取某一个类型的所有bean。</p>
<p>经过上面的分析，我们可以知道BeanFactory完成了Bean初始化的整个流程。BeanFactory的工作流程如下：</p>
<p>1- getBean, 在beanDefinitionMap里面得到bean，如果没有的话，先初始化。（为什么会没有，因为ApplicationContext读取xml文件时候，只是给BeanDefinition服了类类型，并没有赋值对象，这个对象还是需要BeanFactory通过反射生成的）。</p>
<p>2- createBeanInstance，通过反射，根据BeanDefinition的类对象新建实体对象-&gt;将得到的bean对象赋值给beandefinition，然后将BeanDefinition里面的属性都注入到Bean里面，这就完成了doCreateBean。</p>
<p>3- initializeBean就是调用BeanPostProcessor的postProcessBeforeInitilizztion方法和postProcessAfterIntilizatin方法，获取新的bean，这里会在aop中用到。</p>
<p>好了，到这BeanFactory就讲完了，下面是更重要的ApplicationContext。</p>
<h3 id="ApplicationContext-用户与BeanFactory之间的桥梁"><a href="#ApplicationContext-用户与BeanFactory之间的桥梁" class="headerlink" title="ApplicationContext-用户与BeanFactory之间的桥梁"></a>ApplicationContext-用户与BeanFactory之间的桥梁</h3><p>beans.context包有三个类、接口，完成了ApplicationContext的基本功能。</p>
<p>1- ApplicationContext接口，没有任何方法，只是继承了BeanFactory接口，暗示ApplicationContext与BeanFactory都是获取Bean的地方。</p>
<p>2- AbstractApplicationContext抽象类，首先，它的构造函数接收入参BeanFactory，所以说ApplicationContext内部具有一个BeanFactory。类似于一种装饰器模式，但不是装饰器模式，类似于代理模式，但也不是代理模式。fresh方法分为三个步骤：1.loadBeanDefinitions，这个是一个模板方法，需要子类实现，它的作用就是从某一个地方读取BeanDefinition，然后写入到ApplicationContext自己的BeanFactory里面，这就是ApplicationContext与BeanFactory之间的联系，也就是ApplicationContext还负责了读取定义。2. registerBeanPostProcessors，这个就是在BeanFactory里面找到BeanPostProcessor，然后将他们放到BeanFactory的beanPostProcessors容器里面，方便BeanFactory初始化使用。3. onRefresh初始化一遍所有的bean。</p>
<p>3- ClassPathXmlApplicationContext实现了loadBeanDefinitions的方法，将xml文件和BeanFactory结合在一起。</p>
<p><strong>总结-ApplicationContext初始化流程</strong></p>
<p><img src="/2017/10/26/spring/2.png" alt=""></p>
<p><strong>总结-ApplicationContext获取bean流程</strong></p>
<p><img src="/2017/10/26/spring/3.png" alt=""></p>
<h3 id="AOP–移花接木之魔法"><a href="#AOP–移花接木之魔法" class="headerlink" title="AOP–移花接木之魔法"></a>AOP–移花接木之魔法</h3><p>上一节，讲完了Spring IOC的整个流程，也就是bean从定义获取，到得到bean之间的整个流程。本节，我们接触一下Spring另一个重要概念，AOP。AOP用途十分广泛，其中Spring内部的声明式事务和拦截器都是利用了AOP的强大威力，才得以优雅的实现。</p>
<p>AOP是什么呢，简单来说，它可以让编程人员在不修改对象代码的情况下，为这个对象添加额外的功能或者限制。</p>
<p>很熟悉吧，这就是代理模式！</p>
<p>Java中存在两种代理模式：</p>
<p>一种叫静态代理，就是通过接口继承复用的方式来完成的， 代理类与被代理对象实现相同的接口，然后代理类里面会拥有一个被代理对象，代理类与被代理对象相同的方法，活调用被代理对象的方法，不过中间会加以限制，您翻开任何一本设计模式相关的书，翻到代理模式这一节，讲的就是它了。</p>
<p>另一种叫做动态代理，动态代理就是允许我们在程序运行过程中，为动态生成的对象，动态的生成代理。显然，这比静态代理灵活太多了。<br>Java默认提供了动态代理的实现方式，但是有限制，它要求被代理对象必须实现某一个接口。为了突破这一限制，为普通类也可以提供代理，CGLib这个库横空出世。</p>
<p>因为AOP涉及的知识较为复杂，所以我先将背景知识介绍一下。</p>
<p>1- Java动态代理，就是Java本身提供的代理实现，要求对象必须实现某一个接口。</p>
<p>2- CGLib库，为Java提供了，为普通类提供代理的功能。</p>
<p>3- aopalliance，aop联盟包，统一类aop编程的一些概念，这个包里没有具体的类实现，而是定义了几个重要的概念接口，具体的aop实现，要遵从这些接口编程，才能达到一定的通用性。</p>
<p>4- aspectj包，实现了，通过一种固定的编程语言，通过这种简单的编程语言，我们可以定位到被代理的类，自动完成代理。</p>
<p>在aopallicance里面，定义了几个核心概念:</p>
<p>1- Advice增强，说明这是一个，实现这个接口，说明这个类负责某一种形式的增强。</p>
<p>2- Joinpoint连接点，表示切点与目标方法连接处的信息。</p>
<p>3- MethodInterceptor继承了Interceptor接口，而Interceptor继承了Advice接口，是一种Advice，但是有一个方法invoke。这个方法需要一个参数MethodInvocation。</p>
<p>4- MethodInvocation表示的是连接点的信息以及连接点函数的调用。<br>结合上面的信息，我们发现，其实MethodInterceptor的invoke方法，调用的就是MethodInvocation的proceed方法，而这个proceed方法呢，应该调用的肯定是Method.invoke方法。所以，这是一种变相调用method.invoke的方式。为什么这样做呢，猜一猜的话，肯定是为了代码的复用，哈哈哈，这是废话。</p>
<p>在Spring中，还定义了几个核心概念：</p>
<p>5- Pointcut，切点，可以定位类以及方法</p>
<p>6- Advisor，可以获取一个增强。</p>
<p>7- PointcutAdvisor，定义了哪些方法，具有什么类型的增强。</p>
<p>8- MethodMatcher表示某一个方法是否符合条件</p>
<p>9- ClassFilter 定义了某个类是否符合条件。</p>
<p>10- TargetSource被代理的对象，包括对象本身，类类型、所有接口</p>
<p>11- AdvisedSupport代理相关的元数据，包括被代理的对象，增强等。</p>
<p>12- ProxyFactory，代理工厂，可以获得一个代理对象，同时具有AdvisedSupport的所有特性。</p>
<p>13- Cglib2AopProxy，使用cglib实现的动态代理类，继承了AbstractAopProxy抽象类，这个类的主要方法就是getProxy，通过什么呢，通过AdvisorSupport。</p>
<p>14- ReflectiveMethodInvocation可以获取连接点的信息，代理的对象等。</p>
<p>15- JdkDynamicAopProxy，和Cglib2AopProxy类一个作用，通过AdvisorSupport来getProxy，不过是使用Java自带的动态代理实现的。<br>其中，ProxyFactory是获取一个代理对象的直接工厂，而这个代理对象，可以通过Cglib2AopProxy产生，也可以通过JdkDynamicAopProxy产生。</p>
<p>Spring AOP之所以能够为动态生成的Bean提供代理，得益于PostProcessor接口。我们会议IOC初始化流程中，最后一部，就是得到BeanFactory之中所有继承了PostProcessor接口的bean，调用它们的postProcessBeforeInitilization、postProcessAfterInitilization方法，来代理bean，生成新的bean。</p>
<p>基于这个突破口，我们只需要在xml配置文件中，放入PostProcessor对象，Spring就会自动的用这写对象，来代理真正的对象。</p>
<p><img src="/2017/10/26/spring/4.png" alt=""></p>
<p>在这里，我们的对象是AspectJAwareAdvisorAutoProxyCreator。<br>在这个对象的方法中，逻辑是这样的，找到xml里面所有切面bean，然后在这些bean里面，找到符合被代理类的切面bean，找到切面bean之后，就可以获得增强，切点等，于是可有构造一个AdvisorSupport，知道了AdvisorSupport，我们就能够通过proxyFactory来获取代理了。</p>
<p>至于如何这个类切面是用来切入代理类的，这个就要交给PointCut来实现了，pointcut有很多实现方式，这里我们用的是aspectj。具体这个类我就不细讲了。</p>
<p>到目前位置，我自己已经将整个AOP的流程搞清楚了，下面通过流程图的形式展示出来：</p>
<p><img src="/2017/10/26/spring/5.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/26/saas/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/26/saas/" itemprop="url">
                  云计算之PaaS，IaaS，SaaS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-26 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-26T23:47:44+08:00">2017-10-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 12:42:21" itemprop="dateModified" datetime="2017-11-11T12:42:21+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/架构/" itemprop="url" rel="index"><span itemprop="name">架构</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iaas（基础设施即服务Infrastructure as a Servic）</span><br><span class="line"></span><br><span class="line">Paas（平台即服务Platform-as-a-Service）</span><br><span class="line"></span><br><span class="line">Saas（软件即服务Software-as-a-Service）</span><br></pre></td></tr></table></figure>
<p><img src="/2017/10/26/saas/1.jpg" alt=""></p>
<h3 id="IaaS-Infrastructure-as-a-Service（基础设施即服务）"><a href="#IaaS-Infrastructure-as-a-Service（基础设施即服务）" class="headerlink" title="IaaS: Infrastructure-as-a-Service（基础设施即服务）"></a>IaaS: Infrastructure-as-a-Service（基础设施即服务）</h3><ul>
<li>第一层叫做IaaS，有时候也叫做Hardware-as-a-Service，几年前如果你想在办公室或者公司的网站上运行一些企业应用，你需要去买服务器，或者别的高昂的硬件来控制本地应用，让你的业务运行起来。</li>
<li>但是现在有IaaS，你可以将硬件外包到别的地方去。IaaS公司会提供场外服务器，存储和网络硬件，你可以租用。节省了维护成本和办公场地，公司可以在任何时候利用这些硬件来运行其应用。</li>
<li>一些大的IaaS公司包括Amazon, Microsoft, VMWare, Rackspace和Red Hat.不过这些公司又都有自己的专长，比如Amazon和微软给你提供的不只是IaaS，他们还会将其计算能力出租给你来host你的网站。</li>
</ul>
<h3 id="PaaS-Platform-as-a-Service（平台即服务）"><a href="#PaaS-Platform-as-a-Service（平台即服务）" class="headerlink" title="PaaS: Platform-as-a-Service（平台即服务）"></a>PaaS: Platform-as-a-Service（平台即服务）</h3><ul>
<li>第二层就是所谓的PaaS，某些时候也叫做中间件。你公司所有的开发都可以在这一层进行，节省了时间和资源。</li>
<li>PaaS公司在网上提供各种开发和分发应用的解决方案，比如虚拟服务器和操作系统。这节省了你在硬件上的费用，也让分散的工作室之间的合作变得更加容易。网页应用管理，应用设计，应用虚拟主机，存储，安全以及应用开发协作工具等。</li>
<li>一些大的PaaS提供者有Google App Engine,Microsoft Azure，Force.com,Heroku，Engine Yard。最近兴起的公司有AppFog, Mendix 和 Standing Cloud</li>
</ul>
<h3 id="SaaS-Software-as-a-Service（软件即服务）"><a href="#SaaS-Software-as-a-Service（软件即服务）" class="headerlink" title="SaaS: Software-as-a-Service（软件即服务）"></a>SaaS: Software-as-a-Service（软件即服务）</h3><ul>
<li>第三层也就是所谓SaaS。这一层是和你的生活每天接触的一层，大多是通过网页浏览器来接入。任何一个远程服务器上的应用都可以通过网络来运行，就是SaaS了。</li>
<li>你消费的服务完全是从网页如Netflix, MOG, Google Apps, Box.net, Dropbox或者苹果的iCloud那里进入这些分类。尽管这些网页服务是用作商务和娱乐或者两者都有，但这也算是云技术的一部分。</li>
<li>一些用作商务的SaaS应用包括Citrix的GoToMeeting，Cisco的WebEx，Salesforce的CRM，ADP，Workday和SuccessFactors。</li>
</ul>
<h3 id="Iaas和Paas之间的比较"><a href="#Iaas和Paas之间的比较" class="headerlink" title="Iaas和Paas之间的比较"></a>Iaas和Paas之间的比较</h3><p>PaaS的主要作用是将一个开发和运行平台作为服务提供给用户，而IaaS的主要作用是提供虚拟机或者其他资源作为服务提供给用户。接下来，将在七个方面对PaaS和IaaS进行比较：</p>
<ul>
<li>1) 开发环境：PaaS基本都会给开发者提供一整套包括IDE在内的开发和测试环境，而IaaS方面用户主要还是沿用之前比较熟悉那套开发环境，但是因为之前那套开发环境在和云的整合方面比较欠缺，所以使用起来不是很方便。</li>
<li>2) 支持的应用：因为IaaS主要是提供虚拟机，而且普通的虚拟机能支持多种操作系统，所以IaaS支持的应用的范围是非常广泛的。但如果要让一个应用能跑在某个PaaS平台不是一件轻松的事，因为不仅需要确保这个应用是基于这个平台所支持的语言，而且也要确保这个应用只能调用这个平台所支持的API，如果这个应用调用了平台所不支持的API，那么就需要对这个应用进行修改。</li>
<li>3) 开放标准：虽然很多IaaS平台都存在一定的私有功能，但是由于OVF等协议的存在，使得IaaS在跨平台和避免被供应商锁定这两面是稳步前进的。而PaaS平台的情况则不容乐观，因为不论是Google的App Engine，还是Salesforce的Force.com都存在一定的私有API。</li>
<li>4) 可伸缩性：PaaS平台会自动调整资源来帮助运行于其上的应用更好地应对突发流量。而IaaS平台则需要开发人员手动对资源进行调整才能应对。</li>
<li>5) 整合率和经济性： PaaS平台整合率是非常高，比如PaaS的代表Google App Engine能在一台服务器上承载成千上万的应用，而普通的IaaS平台的整合率最多也不会超过100，而且普遍在10左右，使得IaaS的经济性不如PaaS。</li>
<li>6) 计费和监管：因为PaaS平台在计费和监管这两方面不仅达到了IaaS平台所能企及的操作系统层面，比如，CPU和内存的使用量等，而且还能做到应用层面，比如，应用的反应时间（Response Time）或者应用所消耗的事务多少等，这将提高计费和管理的精确性。</li>
<li>7) 学习难度：因为在IaaS上面开发和管理应用和现有的方式比较接近，而PaaS上面开发则有可能需要学一门新的语言或者新的框架，所以IaaS学习难度更低。</li>
</ul>
<p><img src="/2017/10/26/saas/2.png" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/24/im/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/24/im/" itemprop="url">
                  简述移动端IM开发的那些坑：架构设计、通信协议和客户端
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-24 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-24T23:47:44+08:00">2017-10-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 12:32:27" itemprop="dateModified" datetime="2017-11-11T12:32:27+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/架构/" itemprop="url" rel="index"><span itemprop="name">架构</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h3><p>有过移动端开发经历的开发者都深有体会：移动端IM的开发，与传统PC端IM有很大的不同，尤其无线网络的不可靠性、移动端硬件设备资源的有限性等问题，导致一个完整的移动端IM架构设计和实现都充满着大量的挑战。本文将简述移动端IM最重要的架构设计和通信协议选择方面的坑点，希望为IM开发者同行带来些许启发。</p>
<h3 id="2、学习交流"><a href="#2、学习交流" class="headerlink" title="2、学习交流"></a>2、学习交流</h3><p>移动端IM开发推荐文章：<a href="http://www.52im.net/thread-464-1-1.html" target="_blank" rel="external">《新手入门一篇就够：从零开发移动端IM》</a></p>
<h3 id="3、概述"><a href="#3、概述" class="headerlink" title="3、概述"></a>3、概述</h3><p><img src="/2017/10/24/im/1.jpeg" alt=""></p>
<p>移动互联网时代的来临促使我们所有的开发者都要从用户视角出发，基于某一特定场景来创建应用，满足用户需求。通常，在这些应用中，沟通环节都是必不可少的。这就要求创业者不仅要花时间和精力来琢磨用户在某一特定场景下有何痛点需求，琢磨如何解决这一需求，并且可能还要花费更多的精力和时间来解决产品中“沟通”这一技术节点。</p>
<p>而要解决沟通问题，就需要一套IM系统（而且肯定要支持移动端）。做为IM开发者或即将成为IM开发者的技术人员，IM的价值和重要性不言自明。但从技术实现来说，这并不容易。当然，假设你有100个用户，什么都是容易的，但是假设你有了100万、1000万甚至1亿的用户，再简单的技术节点解决不好，都会成为灾难，何况IM系统（尤其是移动端的IM系统）还是存在许多技术难点和坑点的。</p>
<h3 id="4、有关移动端IM通信协议的坑"><a href="#4、有关移动端IM通信协议的坑" class="headerlink" title="4、有关移动端IM通信协议的坑"></a>4、有关移动端IM通信协议的坑</h3><p>其次，我们再看一下IM 协议如何选型。通常IM采取的协议有xmpp、mqtt、protobuf等数据通信私有协议，我们来逐一分析他们的优缺点。</p>
<h4 id="1-XMPP协议："><a href="#1-XMPP协议：" class="headerlink" title="1. XMPP协议："></a>1. XMPP协议：</h4><p>优点：基于xml协议，容易理解，使用广泛，易于扩展。</p>
<p>缺点：流量大，在移动终端也耗电。交互过程复杂。多被pc时代的产品使用，不适合移动时代的IM产品，即使我们基于xmpp进行改进，简化握手过程，改进文件传输机制，但是它的基因决定了如何改进，他都不适合移动互联网时代的IM产品。就像凤姐无论怎么整容，也变成不了高圆圆一样。</p>
<h4 id="2-MQTT协议："><a href="#2-MQTT协议：" class="headerlink" title="2. MQTT协议："></a>2. MQTT协议：</h4><p>优点：适配多平台。</p>
<p>缺点：协议简单，但是需要自己扩展好友，群组等功能。</p>
<h4 id="3-私有协议："><a href="#3-私有协议：" class="headerlink" title="3. 私有协议："></a>3. 私有协议：</h4><p>优点：随心所欲，自己定义，流量小。</p>
<p>缺点：工作量巨大，扩展性差，需要考虑全面。</p>
<h4 id="4-Protobuf协议："><a href="#4-Protobuf协议：" class="headerlink" title="4. Protobuf协议："></a>4. Protobuf协议：</h4><p>优点：非常小、非常快、非常简单，一条消息数据用Protobuf序列化后的大小是JSON的1/10、XML格式的1/20、是二进制序列化的1/10。</p>
<p>缺点：不能表示复杂的数据结构，但是对于IM来讲，已经足够。强烈推荐此协议。</p>
<h4 id="补充1：强列建议使用Protobuf，理由如下"><a href="#补充1：强列建议使用Protobuf，理由如下" class="headerlink" title="补充1：强列建议使用Protobuf，理由如下"></a>补充1：强列建议使用Protobuf，理由如下</h4><p>灵活、高效：灵活（方便接口更新）、高效（效率经过google的优化，传输效率比普通的XML等高很多）；</p>
<p>易于使用：开发人员通过按照一定的语法定义结构化的消息格式，然后送给命令行工具，工具将自动生成相关的类，可以支持java、c++、python等语言环境。通过将这些类包含在项目中，可以很轻松的调用相关方法来完成业务消息的序列化与反序列化工作。</p>
<p>语言支持：原生支持c++、java、python等多达10余种语言。</p>
<h4 id="补充2：Protobuf主要适用于"><a href="#补充2：Protobuf主要适用于" class="headerlink" title="补充2：Protobuf主要适用于"></a>补充2：Protobuf主要适用于</h4><p>需要和其它系统做消息交换的，对消息大小很敏感的。那么protobuf适合了，它语言无关，消息空间相对xml和json等节省很多。</p>
<p>小数据的场合。如果你是大数据，用它并不适合。</p>
<p>项目语言是c++、java、python等，因为它们可以使用google的源生类库，序列化和反序列化的效率非常高。其它的语言需要第三方或者自己写，序列化和反序列化的效率不保证。</p>
<p>总体而言，Protobuf还是非常好用的，被很多开源系统用于数据通信的工具，在google也是核心的基础库。（更多文章：<a href="http://www.52im.net/thread-277-1-1.html" target="_blank" rel="external">《强列建议将Protobuf作为你的即时通讯应用数据传输格式》</a>、<a href="http://www.52im.net/thread-276-1-1.html" target="_blank" rel="external">《如何选择即时通讯应用的数据传输格式》</a>、<a href="http://www.52im.net/thread-283-1-1.html" target="_blank" rel="external">《理论联系实际：一套典型的IM通信协议设计详解》</a>）</p>
<h3 id="5、移动端IM客户端的坑"><a href="#5、移动端IM客户端的坑" class="headerlink" title="5、移动端IM客户端的坑"></a>5、移动端IM客户端的坑</h3><p>最后，我们再来了解一下移动端有哪些难点需要解决。</p>
<h4 id="1-流量："><a href="#1-流量：" class="headerlink" title="1. 流量："></a>1. 流量：</h4><p>采取哪种协议、图片缩略图、附件的压缩三点决定了流量的大小。</p>
<h4 id="2-耗电："><a href="#2-耗电：" class="headerlink" title="2. 耗电："></a>2. 耗电：</h4><p>(1)流量越小，耗电越低。(2)心跳策略，减少心跳次数，耗电量就会降低。</p>
<h4 id="3-心跳时长："><a href="#3-心跳时长：" class="headerlink" title="3. 心跳时长："></a>3. 心跳时长：</h4><p>wifi，2G，3G，4G，移动、电信、联通,不同网络，不同运行商，NAT失效时间不一样，因此心跳的时间也就不一样。</p>
<h4 id="4-网络连接："><a href="#4-网络连接：" class="headerlink" title="4. 网络连接："></a>4. 网络连接：</h4><p>cmnet和cmwap下连接处理机制。</p>
<h4 id="5-网络不稳定："><a href="#5-网络不稳定：" class="headerlink" title="5. 网络不稳定："></a>5. 网络不稳定：</h4><p>移动端最大的特点就是网络不稳定，在不稳定的网络状态下，如何保证消息以最快的速度到达？如何避免重联风暴？这些既需要从整体架构考虑，也需要在移动端采取巧妙的策略加以避免。（更多文章：移动端IM开发需要面对的技术问题）</p>
<h3 id="6、移动端IM架构设计的坑"><a href="#6、移动端IM架构设计的坑" class="headerlink" title="6、移动端IM架构设计的坑"></a>6、移动端IM架构设计的坑</h3><p>首先，来看移动端IM架构设计需要考虑的问题。</p>
<h4 id="1-连接器的设计："><a href="#1-连接器的设计：" class="headerlink" title="1. 连接器的设计："></a>1. 连接器的设计：</h4><p>连接器主要用来管理客户端的长连接。目前最好的连接器单台8G8核的服务器可以做到70万—100万的连接，而某些开发者只能做到4000左右的连接，相差好几个数量级。这里的奥妙在哪里呢？</p>
<h4 id="2-中间件的设计："><a href="#2-中间件的设计：" class="headerlink" title="2. 中间件的设计："></a>2. 中间件的设计：</h4><p>是否采用通讯中间件？通讯中间件的好处有哪些？如果不采用中间件，连接器和逻辑服务器的连接关系如何管理呢？</p>
<h4 id="3-逻辑服务器："><a href="#3-逻辑服务器：" class="headerlink" title="3. 逻辑服务器："></a>3. 逻辑服务器：</h4><p>逻辑服务器通常简单一点，主要是根据业务逻辑进行最小粒度的划分即可。但是即便如此，还是有很多的开发者把看似相关实则不相关的逻辑放在一起，如把鉴权和message服务器放在一起。</p>
<h4 id="4-状态服务器："><a href="#4-状态服务器：" class="headerlink" title="4. 状态服务器："></a>4. 状态服务器：</h4><p>状态服务器主要管理用户在线、离线的相关状态，需要采取中心节点的方案，否则状态就会不同步。这里主要需要考虑状态服务器所对应的数据存储机制，如何进行写操作，如何进行读操作？以便最大的提高状态服务器的处理能力和响应速度。</p>
<h4 id="5-数据库的设计："><a href="#5-数据库的设计：" class="headerlink" title="5. 数据库的设计："></a>5. 数据库的设计：</h4><p>数据库的设计是最难的，也是做大的瓶颈。因为无论对于sql（关系型）数据库还是nosql（非关系型）数据库，都有读写处理的极限，那就需要考虑数据库如何分区（根据什么原则、什么操作、哪些用户访问哪个节点上的数据库）。同时又需要考虑每个原子操作（如登陆）需要读哪些库，写哪些库。只有这些指标明确了，你才能在假设有100万并发用户，100万条并发消息的情况下，准确评估服务端需要多少台服务器，如何部署。</p>
<h4 id="6-其他："><a href="#6-其他：" class="headerlink" title="6. 其他："></a>6. 其他：</h4><p>还有设备推送的处理，何种机制能够保证不丢消息，离线消息如何处理，等等。这些都是必备而又非常复杂的功能点和技术要求，都需要采取正确的架构和策略才能实现。（更多文章：<a href="http://www.52im.net/forum.php...）" target="_blank" rel="external">http://www.52im.net/forum.php...）</a></p>
<h3 id="7、结语"><a href="#7、结语" class="headerlink" title="7、结语"></a>7、结语</h3><p>以上难点和坑点草草记录下来也不过千把字，但是真正要解决这些问题并达到生产应用标准，却要不知道花费多少日日夜夜、敲下多少行代码，恐怕也只有真正做过IM的开发者才有比较深刻的体会。</p>
<p>来源：<a href="https://segmentfault.com/a/1190000006751684" target="_blank" rel="external">https://segmentfault.com/a/1190000006751684</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/23/uuid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/23/uuid/" itemprop="url">
                  分布式系统如何生成全局唯一的ID
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-23 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-23T23:47:44+08:00">2017-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 12:26:24" itemprop="dateModified" datetime="2017-11-11T12:26:24+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/架构/" itemprop="url" rel="index"><span itemprop="name">架构</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、-问题描述"><a href="#一、-问题描述" class="headerlink" title="一、 问题描述"></a>一、 问题描述</h3><p>在分布式系统存在多个 Shard 的场景中, 同时在各个 Shard 插入数据时, 怎么给这些数据生成全局的 unique ID?</p>
<p>在单机系统中 (例如一个 MySQL 实例), unique ID 的生成是非常简单的, 直接利用 MySQL 自带的自增 ID 功能就可以实现.</p>
<p>但在一个存在多个 Shards 的分布式系统 (例如多个 MySQL 实例组成一个集群, 在这个集群中插入数据), 这个问题会变得复杂, 所生成的全局的 unique ID 要满足以下需求:</p>
<ul>
<li>保证生成的 ID 全局唯一</li>
<li>今后数据在多个 Shards 之间迁移不会受到 ID 生成方式的限制</li>
<li>生成的 ID 中最好能带上时间信息, 例如 ID 的前 k 位是 Timestamp, 这样能够直接通过对 ID 的前 k 位的排序来对数据按时间排序</li>
<li>生成的 ID 最好不大于 64 bits</li>
<li>生成 ID 的速度有要求. 例如, 在一个高吞吐量的场景中, 需要每秒生成几万个 ID (Twitter 最新的峰值到达了 143,199 Tweets/s, 也就是 10万+/秒)</li>
<li>整个服务最好没有单点  </li>
</ul>
<p>如果没有上面这些限制, 问题会相对简单, 例如:</p>
<ul>
<li>直接利用 UUID.randomUUID() 接口来生成 unique ID (<a href="http://www.ietf.org/rfc/rfc4122.txt" target="_blank" rel="external">http://www.ietf.org/rfc/rfc4122.txt</a>). 但这个方案生成的 ID 有 128 bits, 另外, 生成的 ID 中也没有带 Timestamp</li>
<li>利用一个中心服务器来统一生成 unique ID. 但这种方案可能存在单点问题; 另外, 要支持高吞吐率的系统, 这个方案还要做很多改进工作 (例如, 每次从中心服务器批量获取一批 IDs, 提升 ID 产生的吞吐率)</li>
<li>Flickr 的做法 (<a href="http://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/" target="_blank" rel="external">http://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/</a>). 但他这个方案 ID 中没有带 Timestamp, 生成的 ID 不能按时间排序</li>
</ul>
<p><strong>在要满足前面 6 点要求的场景中, 怎么来生成全局 unique ID 呢?</strong></p>
<p>Twitter 的 Snowflake 是一种比较好的做法. 下面主要介绍 Twitter Snowflake, 以及它的变种</p>
<h3 id="二、Twitter-Snowflake"><a href="#二、Twitter-Snowflake" class="headerlink" title="二、Twitter Snowflake"></a>二、Twitter Snowflake</h3><p><a href="https://github.com/twitter/snowflake" target="_blank" rel="external">https://github.com/twitter/snowflake</a></p>
<p>Snowflake 生成的 unique ID 的组成 (由高位到低位):</p>
<ul>
<li>41 bits: Timestamp (毫秒级)</li>
<li>10 bits: 节点 ID (datacenter ID 5 bits + worker ID 5 bits)</li>
<li>12 bits: sequence number</li>
</ul>
<p>一共 63 bits (最高位是 0)</p>
<p>unique ID 生成过程:</p>
<ul>
<li>10 bits 的机器号, 在 ID 分配 Worker 启动的时候, 从一个 Zookeeper 集群获取 (保证所有的 Worker 不会有重复的机器号)</li>
<li>41 bits 的 Timestamp: 每次要生成一个新 ID 的时候, 都会获取一下当前的 Timestamp, 然后分两种情况生成 sequence number:</li>
<li>如果当前的 Timestamp 和前一个已生成 ID 的 Timestamp 相同 (在同一毫秒中), 就用前一个 ID 的 sequence number + 1 作为新的 sequence number (12 bits); 如果本毫秒内的所有 ID 用完, 等到下一毫秒继续 (这个等待过程中, 不能分配出新的 ID)</li>
<li>如果当前的 Timestamp 比前一个 ID 的 Timestamp 大, 随机生成一个初始 sequence number (12 bits) 作为本毫秒内的第一个 sequence number</li>
</ul>
<p>整个过程中, 只是在 Worker 启动的时候会对外部有依赖 (需要从 Zookeeper 获取 Worker 号), 之后就可以独立工作了, 做到了去中心化.</p>
<h3 id="异常情况讨论"><a href="#异常情况讨论" class="headerlink" title="异常情况讨论:"></a>异常情况讨论:</h3><ul>
<li>在获取当前 Timestamp 时, 如果获取到的时间戳比前一个已生成 ID 的 Timestamp 还要小怎么办? Snowflake 的做法是继续获取当前机器的时间, 直到获取到更大的 Timestamp 才能继续工作 (在这个等待过程中, 不能分配出新的 ID) </li>
</ul>
<p>从这个异常情况可以看出, 如果 Snowflake 所运行的那些机器时钟有大的偏差时, 整个 Snowflake 系统不能正常工作 (偏差得越多, 分配新 ID 时等待的时间越久)</p>
<p>从 Snowflake 的官方文档 (<a href="https://github.com/twitter/snowflake/#system-clock-dependency" target="_blank" rel="external">https://github.com/twitter/snowflake/#system-clock-dependency</a>) 中也可以看到, 它明确要求 “You should use NTP to keep your system clock accurate”. 而且最好把 NTP 配置成不会向后调整的模式. 也就是说, NTP 纠正时间时, 不会向后回拨机器时钟.</p>
<h3 id="三、-Snowflake-的其他变种"><a href="#三、-Snowflake-的其他变种" class="headerlink" title="三、 Snowflake 的其他变种"></a>三、 Snowflake 的其他变种</h3><p>Snowflake 有一些变种, 各个应用结合自己的实际场景对 Snowflake 做了一些改动. 这里主要介绍 3 种.</p>
<h3 id="1-Boundary-flake"><a href="#1-Boundary-flake" class="headerlink" title="1. Boundary flake"></a>1. Boundary flake</h3><p><a href="http://boundary.com/blog/2012/01/12/flake-a-decentralized-k-ordered-unique-id-generator-in-erlang/" target="_blank" rel="external">http://boundary.com/blog/2012/01/12/flake-a-decentralized-k-ordered-unique-id-generator-in-erlang/</a></p>
<p>变化:</p>
<ul>
<li>ID 长度扩展到 128 bits:</li>
<li>最高 64 bits 时间戳;</li>
<li>然后是 48 bits 的 Worker 号 (和 Mac 地址一样长);</li>
<li>最后是 16 bits 的 Seq Number</li>
<li>由于它用 48 bits 作为 Worker ID, 和 Mac 地址的长度一样, 这样启动时不需要和 Zookeeper 通讯获取 Worker ID. 做到了完全的去中心化</li>
<li>基于 Erlang</li>
</ul>
<p>它这样做的目的是用更多的 bits 实现更小的冲突概率, 这样就支持更多的 Worker 同时工作. 同时, 每毫秒能分配出更多的 ID</p>
<h3 id="2-Simpleflake"><a href="#2-Simpleflake" class="headerlink" title="2. Simpleflake"></a>2. Simpleflake</h3><p><a href="http://engineering.custommade.com/simpleflake-distributed-id-generation-for-the-lazy/" target="_blank" rel="external">http://engineering.custommade.com/simpleflake-distributed-id-generation-for-the-lazy/</a></p>
<p>Simpleflake 的思路是取消 Worker 号, 保留 41 bits 的 Timestamp, 同时把 sequence number 扩展到 22 bits;</p>
<p>Simpleflake 的特点:</p>
<ul>
<li>sequence number 完全靠随机产生 (这样也导致了生成的 ID 可能出现重复)</li>
<li>没有 Worker 号, 也就不需要和 Zookeeper 通讯, 实现了完全去中心化</li>
<li>Timestamp 保持和 Snowflake 一致, 今后可以无缝升级到 Snowflake</li>
</ul>
<p>Simpleflake 的问题就是 sequence number 完全随机生成, 会导致生成的 ID 重复的可能. 这个生成 ID 重复的概率随着每秒生成的 ID 数的增长而增长.</p>
<p>所以, Simpleflake 的限制就是每秒生成的 ID 不能太多 (最好小于 100次/秒, 如果大于 100次/秒的场景, Simpleflake 就不适用了, 建议切换回 Snowflake).</p>
<h3 id="3-instagram-的做法"><a href="#3-instagram-的做法" class="headerlink" title="3. instagram 的做法"></a>3. instagram 的做法</h3><p>先简单介绍一下 instagram 的分布式存储方案:</p>
<ul>
<li>先把每个 Table 划分为多个逻辑分片 (logic Shard), 逻辑分片的数量可以很大, 例如 2000 个逻辑分片</li>
<li>然后制定一个规则, 规定每个逻辑分片被存储到哪个数据库实例上面; 数据库实例不需要很多. 例如, 对有 2 个 PostgreSQL 实例的系统 (instagram 使用 PostgreSQL); 可以使用奇数逻辑分片存放到第一个数据库实例, 偶数逻辑分片存放到第二个数据库实例的规则</li>
<li>每个 Table 指定一个字段作为分片字段 (例如, 对用户表, 可以指定 uid 作为分片字段)</li>
<li>插入一个新的数据时, 先根据分片字段的值, 决定数据被分配到哪个逻辑分片 (logic Shard)</li>
<li>然后再根据 logic Shard 和 PostgreSQL 实例的对应关系, 确定这条数据应该被存放到哪台 PostgreSQL 实例上</li>
</ul>
<p>instagram unique ID 的组成:</p>
<ul>
<li>41 bits: Timestamp (毫秒)</li>
<li>13 bits: 每个 logic Shard 的代号 (最大支持 8 x 1024 个 logic Shards)</li>
<li>10 bits: sequence number; 每个 Shard 每毫秒最多可以生成 1024 个 ID</li>
</ul>
<p>生成 unique ID 时, 41 bits 的 Timestamp 和 Snowflake 类似, 这里就不细说了.</p>
<p>主要介绍一下 13 bits 的 logic Shard 代号 和 10 bits 的 sequence number 怎么生成.</p>
<p>logic Shard 代号:</p>
<ul>
<li>假设插入一条新的用户记录, 插入时, 根据 uid 来判断这条记录应该被插入到哪个 logic Shard 中.</li>
<li>假设当前要插入的记录会被插入到第 1341 号 logic Shard 中 (假设当前的这个 Table 一共有 2000 个 logic Shard)</li>
<li>新生成 ID 的 13 bits 段要填的就是 1341 这个数字</li>
</ul>
<p>sequence number 利用 PostgreSQL 每个 Table 上的 auto-increment sequence 来生成:</p>
<ul>
<li>如果当前表上已经有 5000 条记录, 那么这个表的下一个 auto-increment sequence 就是 5001 (直接调用 PL/PGSQL 提供的方法可以获取到)</li>
<li>然后把 这个 5001 对 1024 取模就得到了 10 bits 的 sequence number</li>
</ul>
<p>instagram 这个方案的优势在于:</p>
<ul>
<li>利用 logic Shard 号来替换 Snowflake 使用的 Worker 号, 就不需要到中心节点获取 Worker 号了. 做到了完全去中心化</li>
<li>另外一个附带的好处就是, 可以通过 ID 直接知道这条记录被存放在哪个 logic Shard 上</li>
</ul>
<p>同时, 今后做数据迁移的时候, 也是按 logic Shard 为单位做数据迁移的, 所以这种做法也不会影响到今后的数据迁移</p>
<p>来源： <a href="http://darktea.github.io/notes/2013/12/08/Unique-ID" target="_blank" rel="external">http://darktea.github.io/notes/2013/12/08/Unique-ID</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/23/dbnf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/23/dbnf/" itemprop="url">
                  数据库范式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-23 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-23T23:47:44+08:00">2017-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 11:41:12" itemprop="dateModified" datetime="2017-11-11T11:41:12+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>数据库范式在数据库设计中的地位一直很暧昧，教科书中对于数据库范式倒是都给出了学术性的定义，但实际应用中范式的应用却不甚乐观，这篇文章会用简单的语言和一个简单的数据库DEMO将一个不符合范式的数据库一步步从第一范式实现到第四范式。</p>
<h3 id="范式的目标"><a href="#范式的目标" class="headerlink" title="范式的目标"></a>范式的目标</h3><p>应用数据库范式可以带来许多好处，但是最重要的好处归结为三点：</p>
<p>1.减少数据冗余（这是最主要的好处，其他好处都是由此而附带的）</p>
<p>2.消除异常（插入异常，更新异常，删除异常）</p>
<p>3.让数据组织的更加和谐…</p>
<p>但剑是双刃的，应用数据库范式同样也会带来弊端，这会在文章后面说到。</p>
<h3 id="什么是范式"><a href="#什么是范式" class="headerlink" title="什么是范式"></a>什么是范式</h3><p>简单的说，范式是为了消除重复数据减少冗余数据，从而让数据库内的数据更好的组织，让磁盘空间得到更有效利用的一种标准化标准，满足高等级的范式的先决条件是满足低等级范式。(比如满足2nf一定满足1nf)</p>
<h3 id="DEMO"><a href="#DEMO" class="headerlink" title="DEMO"></a>DEMO</h3><p>让我们先从一个未经范式化的表看起,表如下：</p>
<p><img src="/2017/10/23/dbnf/1.png" alt=""></p>
<p>先对表做一个简单说明，employeeId是员工id,departmentName是部门名称，job代表岗位，jobDescription是岗位说明，skill是员工技能，departmentDescription是部门说明，address是员工住址</p>
<h3 id="对表进行第一范式-1NF"><a href="#对表进行第一范式-1NF" class="headerlink" title="对表进行第一范式(1NF)"></a>对表进行第一范式(1NF)</h3><p>如果一个关系模式R的所有属性都是不可分的基本数据项，则R∈1NF。</p>
<p>简单的说,第一范式就是每一个属性都不可再分。不符合第一范式则不能称为关系数据库。对于上表，不难看出Address是可以再分的，比如”北京市XX路XX小区XX号”，着显然不符合第一范式，对其应用第一范式则需要将此属性分解到另一个表,如下:</p>
<p><img src="/2017/10/23/dbnf/2.png" alt=""></p>
<h3 id="对表进行第二范式-2NF"><a href="#对表进行第二范式-2NF" class="headerlink" title="对表进行第二范式(2NF)"></a>对表进行第二范式(2NF)</h3><p>若关系模式R∈1NF，并且每一个非主属性都完全函数依赖于R的码，则R∈2NF</p>
<p>简单的说，是表中的属性必须完全依赖于全部主键，而不是部分主键.所以只有一个主键的表如果符合第一范式，那一定是第二范式。这样做的目的是进一步减少插入异常和更新异常。在上表中，departmentDescription是由主键DepartmentName所决定，但却不是由主键EmployeeID决定，所以departmentDescription只依赖于两个主键中的一个，故要departmentDescription对主键是部分依赖，对其应用第二范式如下表：</p>
<p>![3.png]</p>
<h3 id="对表进行第三范式-3NF"><a href="#对表进行第三范式-3NF" class="headerlink" title="对表进行第三范式(3NF)"></a>对表进行第三范式(3NF)</h3><p>关系模式R 中若不存在这样的码X、属性组Y及非主属性Z（Z  Y）, 使得X→Y，Y→Z，成立，则称R ∈ 3NF。</p>
<p>简单的说，第三范式是为了消除数据库中关键字之间的依赖关系，在上面经过第二范式化的表中，可以看出jobDescription(岗位职责)是由job(岗位)所决定，则jobDescription依赖于job,可以看出这不符合第三范式，对表进行第三范式后的关系图为：</p>
<p><img src="/2017/10/23/dbnf/4.png" alt=""></p>
<p>上表中，已经不存在数据库属性互相依赖的问题，所以符合第三范式</p>
<h3 id="对表进行BC范式-BCNF"><a href="#对表进行BC范式-BCNF" class="headerlink" title="对表进行BC范式(BCNF)"></a>对表进行BC范式(BCNF)</h3><p>设关系模式R∈1NF，如果对于R的每个函数依赖X→Y，若Y不属于X，则X必含有候选码，那么R∈BCNF。</p>
<p>简单的说，bc范式是在第三范式的基础上的一种特殊情况，既每个表中只有一个候选键（在一个数据库中每行的值都不相同，则可称为候选键），在上面第三范式的noNf表中可以看出，每一个员工的email都是唯一的（难道两个人用同一个email??）则，此表不符合bc范式，对其进行bc范式化后的关系图为:</p>
<p><img src="/2017/10/23/dbnf/5.png" alt=""></p>
<h3 id="对表进行第四范式-4NF"><a href="#对表进行第四范式-4NF" class="headerlink" title="对表进行第四范式(4NF)"></a>对表进行第四范式(4NF)</h3><p>关系模式R∈1NF，如果对于R的每个非平凡多值依赖X→→Y（Y  X），X都含有候选码，则R∈4NF。</p>
<p>简单的说，第四范式是消除表中的多值依赖，也就是说可以减少维护数据一致性的工作。对于上面bc范式化的表中，对于员工的skill，两个可能的值是”C#,sql,javascript”和“C#，UML,Ruby”,可以看出，这个数据库属性存在多个值，这就可能造成数据库内容不一致的问题，比如第一个值写的是”C#”,而第二个值写的是”C#.net”,解决办法是将多值属性放入一个新表，则第四范式化后的关系图如下：</p>
<p><img src="/2017/10/23/dbnf/6.png" alt=""></p>
<p>而对于skill表则可能的值为:</p>
<p><img src="/2017/10/23/dbnf/7.png" alt=""></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>上面对于数据库范式进行分解的过程中不难看出，应用的范式登记越高，则表越多。表多会带来很多问题：</p>
<p>1 查询时要连接多个表，增加了查询的复杂度</p>
<p>2 查询时需要连接多个表，降低了数据库查询性能</p>
<p>而现在的情况，磁盘空间成本基本可以忽略不计，所以数据冗余所造成的问题也并不是应用数据库范式的理由。</p>
<p>因此，并不是应用的范式越高越好，要看实际情况而定。第三范式已经很大程度上减少了数据冗余，并且减少了造成插入异常，更新异常，和删除异常了。我个人观点认为，大多数情况应用到第三范式已经足够，在一定情况下第二范式也是可以的。</p>
<p>来源：<a href="http://www.cnblogs.com/CareySon/archive/2010/02/16/1668803.html" target="_blank" rel="external">http://www.cnblogs.com/CareySon/archive/2010/02/16/1668803.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/23/rxjava/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/23/rxjava/" itemprop="url">
                  Android响应式编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-23 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-23T23:47:44+08:00">2017-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 11:37:23" itemprop="dateModified" datetime="2017-11-11T11:37:23+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>函数响应式编程（FRP）为解决现代编程问题提供了全新的视角。一旦理解它，可以极大地简化你的项目，特别是处理嵌套回调的异步事件，复杂的列表过滤和变换，或者时间相关问题。</p>
<p>我将尽量跳过对函数响应式编程学院式的解释（网络上已经有很多），并重点从实用的角度帮你理解什么是函数响应式编程，以及工作中怎么应用它。本文将围绕函数响应式编程的一个具体实现RxJava， 它可用于Java和Android。</p>
<h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>我们以一个真实的例子来开始讲解函数响应式编程怎么提高我们代码的可读性。我们的任务是通过查询GitHub的API， 首先获取用户列表，然后请求每个用户的详细信息。这个过程包括两个web 服务端点：<a href="https://api.github.com/users" target="_blank" rel="external">https://api.github.com/users</a> - 获取用户列表；<a href="https://api.github.com/users/{username}" target="_blank" rel="external">https://api.github.com/users/{username}</a> －获取特定用户的详细信息，例如 <a href="https://api.github.com/users/mutexkid" target="_blank" rel="external">https://api.github.com/users/mutexkid</a> 。</p>
<h3 id="旧的风格"><a href="#旧的风格" class="headerlink" title="旧的风格"></a>旧的风格</h3><p>下面例子你可能已经很熟悉了：它调用web service，使用回调接口将成功的结果传递给下一个web service请求，同时定义另一个成功回调，然后发起下一个web service请求。你可以看到，这会导致两层嵌套的回调：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//The "Nested Callbacks" Way</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fetchUserDetails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//first, request the users...</span></span><br><span class="line">        mService.requestUsers(<span class="keyword">new</span> Callback&lt;GithubUsersResponse&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">success</span><span class="params">(<span class="keyword">final</span> GithubUsersResponse githubUsersResponse,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="keyword">final</span> Response response)</span> </span>&#123;</span><br><span class="line">                Timber.i(TAG, <span class="string">"Request Users request completed"</span>);</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">synchronized</span> List&lt;GithubUserDetail&gt; githubUserDetails = <span class="keyword">new</span> ArrayList&lt;GithubUserDetail&gt;();</span><br><span class="line">                <span class="comment">//next, loop over each item in the response</span></span><br><span class="line">                <span class="keyword">for</span> (GithubUserDetail githubUserDetail : githubUsersResponse) &#123;</span><br><span class="line">                    <span class="comment">//request a detail object for that user</span></span><br><span class="line">                    mService.requestUserDetails(githubUserDetail.mLogin,</span><br><span class="line">                                                <span class="keyword">new</span> Callback&lt;GithubUserDetail&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">success</span><span class="params">(GithubUserDetail githubUserDetail,</span></span></span><br><span class="line"><span class="function"><span class="params">                                            Response response)</span> </span>&#123;</span><br><span class="line">                            Log.i(<span class="string">"User Detail request completed for user : "</span> + githubUserDetail.mLogin);</span><br><span class="line">                            githubUserDetails.add(githubUserDetail);</span><br><span class="line">                            <span class="keyword">if</span> (githubUserDetails.size() == githubUsersResponse.mGithubUsers.size()) &#123;</span><br><span class="line">                                <span class="comment">//we've downloaded'em all - notify all who are interested!</span></span><br><span class="line">                                mBus.post(<span class="keyword">new</span> UserDetailsLoadedCompleteEvent(githubUserDetails));</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failure</span><span class="params">(RetrofitError error)</span> </span>&#123;</span><br><span class="line">                            Log.e(TAG, <span class="string">"Request User Detail Failed!!!!"</span>, error);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failure</span><span class="params">(RetrofitError error)</span> </span>&#123;</span><br><span class="line">                Log.e(TAG, <span class="string">"Request User Failed!!!!"</span>, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>尽管这不是最差的代码－至少它是异步的，因此在等待每个请求完成的时候不会阻塞－但由于代码复杂（增加更多层次的回调代码复杂度将呈指数级增长）因此远非理想的代码。当我们不可避免要修改代码时（在前面的web service调用中，我们依赖前一次的回调状态，因此它不适用于模块化或者修改要传递给下一个回调的数据）也远非容易的工作。我们亲切的称这种情况为“回调地狱”。</p>
<h3 id="RxJava的方式"><a href="#RxJava的方式" class="headerlink" title="RxJava的方式"></a>RxJava的方式</h3><p>下面让我们看看使用RxJava如何实现相同的功能：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rxFetchUserDetails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//request the users</span></span><br><span class="line">        mService.rxRequestUsers().concatMap(Observable::from)</span><br><span class="line">        .concatMap((GithubUser githubUser) -&gt;</span><br><span class="line">                        <span class="comment">//request the details for each user</span></span><br><span class="line">                        mService.rxRequestUserDetails(githubUser.mLogin)</span><br><span class="line">        )</span><br><span class="line">        <span class="comment">//accumulate them as a list</span></span><br><span class="line">        .toList()</span><br><span class="line">        <span class="comment">//define which threads information will be passed on</span></span><br><span class="line">        .subscribeOn(Schedulers.newThread())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        <span class="comment">//post them on an eventbus</span></span><br><span class="line">        .subscribe(githubUserDetails -&gt; &#123;</span><br><span class="line">            EventBus.getDefault().post(<span class="keyword">new</span> UserDetailsLoadedCompleteEvent(githubUserDetails));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>如你所见，使用函数响应式编程模型我们完全摆脱了回调，并最终得到了更短小的程序。让我们从函数响应式编程的基本定义开始慢慢解释到底发生了什么，并逐渐理解上面的代码，这些代码托管在GitHub上面。</p>
<p>从根本上讲，函数响应式编程是在观察者模式的基础上，增加对Observables发送的数据流进行操纵和变换的功能。在上面的例子中，Observables是我们的数据流通所在的管道。</p>
<p>回顾一下，观察者模式包含两个角色：一个Observable和一个或者多个Observers。Observable发送事件，而Observer订阅和接收这些事件。在上面的例子中，.subscribe()函数用于给Observable添加一个Observer，并创建一个请求。</p>
<h3 id="构建一个Observable管道"><a href="#构建一个Observable管道" class="headerlink" title="构建一个Observable管道"></a>构建一个Observable管道</h3><p>对Observable管道的每个操作都将返回一个新的Observable，这个新的Observable的内容要么和操作前相同，要么就是经过转换的。这种方式使得我们可以对任务进行分解，并把事件流分解成小的操作，接着把这些Observables拼接起来从而完成更复杂的行为或者重用管道中的每个独立的单元。我们对Observable的每个方法调用会被加入到总的管道中以便我们的数据在其中流动。</p>
<p>下面首先让我们从搭建一个Observable开始，来看一个具体的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable sentenceObservable = Observable.from(“<span class="keyword">this</span>”, “is”, “a”, “sentence”);</span><br></pre></td></tr></table></figure></p>
<p>这样我们就定义好了管道的第一个部分：Observable。在其中流通的数据是一个字符串序列。首先要认识到的是这是没有实现任何功能的非阻塞代码，仅仅定义了我们想要完成什么事情。Observable只有在我们“订阅”它之后才会开始工作，也就是说给它注册一个Observer之后。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Observable.subscribe(<span class="keyword">new</span> Action1() &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>到这一步Observable才会发送由每个独立的Observable的from()函数添加的数据块。管道会持续发送Observables直到所有Observables都被处理完成。</p>
<h3 id="变换数据流"><a href="#变换数据流" class="headerlink" title="变换数据流"></a>变换数据流</h3><p>现在我们得到正在发送的字符串流，我们可以按照需要对这些数据流进行变换，并建立更复杂的行为。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Observable&lt;String&gt; sentenceObservable = Observable.from(“<span class="keyword">this</span>”, “is”, “a”, “sentence”);</span><br><span class="line">sentenceObservable.map(<span class="keyword">new</span> Func1&lt;String, String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> s.toUpperCase() + <span class="string">" "</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">.toList()</span><br><span class="line">.map(<span class="keyword">new</span> Func1&lt;List&lt;String&gt;, String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">(List&lt;String&gt; strings)</span> </span>&#123;</span><br><span class="line">                Collections.reverse(strings);</span><br><span class="line">                <span class="keyword">return</span> strings.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="comment">//subscribe to the stream of Observables</span></span><br><span class="line">.subscribe(<span class="keyword">new</span> Action1&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">                System.out.println(s);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>一旦Observable被订阅了，我们会得到“SENTENCE A IS THIS”。上面调用的.map函数接受Func1类的对象，该类有两个范型类型参数：一个是输入类型（前一个Observable的内容），另一个是输出类型（在这个例子中，是一个经过大写转换，格式化并用一个新的Observable实例包装的字符串，最终被传递给下一个函数）。如你所见，我们通过可重用的管道组合实现更复杂的功能。</p>
<p>上面的例子中，我们还可以使用Java8的lambda表达式来进一步简化代码：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(“<span class="keyword">this</span>”, “is”, “a”, “sentence”).map(s -&gt; s.toUpperCase() + “ “).toList().map(strings -&gt; &#123;</span><br><span class="line">Collections.reverse(strings);</span><br><span class="line"><span class="keyword">return</span> strings.toString();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>在subscribe函数中，我们传递Action1类对象作为参数，并以String类型作为范型参数。这定义了订阅者的行为，当被观察者发送最后一个事件后，处理后的字符串就被接收到了。这是.subscribe()函数最简单的重载形式（参见 <a href="https://github.com/ReactiveX/RxJava/wiki/Observable#establishing-subscribers" target="_blank" rel="external">https://github.com/ReactiveX/RxJava/wiki/Observable#establishing-subscribers</a> 可以看到更复杂的函数重载签名）。</p>
<p>这个例子展示了变换函数.map()和聚合函数.toList()，在操纵数据流的能力方面这仅仅是冰山一角（所有可用的数据流操作函数可见 <a href="https://github.com/ReactiveX/RxJava/wiki），" target="_blank" rel="external">https://github.com/ReactiveX/RxJava/wiki），</a> 但它显示了基本概念：在函数响应式编程中，我们可以通过实现了数据转换或者数据操作功能的管道中独立的单元来转换数据流。根据需要我们可以在其他由Observables组成的管道复用这些独立的单元。通过把这些Observable单元拼接在一起，我们可以组成更复杂的特性，但同时保持它们作为易于理解和可修改的可组合逻辑小单元。</p>
<h3 id="使用Scheduler管理线程"><a href="#使用Scheduler管理线程" class="headerlink" title="使用Scheduler管理线程"></a>使用Scheduler管理线程</h3><p>在web service例子中，我们展示了如何使用RxJava发起网络请求。我们谈及转换，聚合和订阅Observable数据流，但我们没有谈及Observable数据流的web请求是怎样实现异步的。</p>
<p>这就属于FRP编程模型如何调用Scheduler的范畴了－该策略定义了Observable流事件在哪个线程中发生，以及订阅者在哪个线程消费Observable的处理结果。在web service例子中，我们希望请求在后台线程中进行，而订阅行为发生在主线程中，因此我们如下定义：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.subscribeOn(Schedulers.newThread())</span><br><span class="line">        .observeOn(AndroidSchedulers.mainThread())</span><br><span class="line">        <span class="comment">//post them on an eventbus</span></span><br><span class="line">        .subscribe(githubUserDetails -&gt; &#123;</span><br><span class="line">            EventBus.getDefault().post(<span class="keyword">new</span> UserDetailsLoadedCompleteEvent(githubUserDetails));</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure></p>
<p><code>Observable.subscribeOn(Scheduler scheduler)</code>函数指定<code>Observable</code>的工作需要在指定的Scheduler线程中执行。  <code>Observable.observeOn(Scheduler scheduler)</code>指定<code>Observable</code>在哪个<code>Scheduler</code>线程触发订阅者们的<code>onNext()</code>，<code>onCompleted()</code>，和<code>onError()</code>函数，并调用<code>Observable</code>的<code>observeOn()</code>函数，传递正确的Scheduler给它。</p>
<p>下面是可能会用到Scheduler：</p>
<p><code>Schedulers.computation()</code>：用于计算型工作例如事件循环和回调处理，不要在I/O中使用这个函数（应该使用Schedulers.io()函数）；</p>
<p><code>Schedulers.from(executor)</code>：使用指定的Executor作为Scheduler；</p>
<p><code>Schedulers.immediate()</code>：在当前线程中立即开始执行任务；</p>
<p><code>Schedulers.io()</code>：用于I/O密集型工作例如阻塞I/O的异步操作，这个调度器由一个会随需增长的线程池支持；对于一般的计算工作，使用<code>Schedulers.computation()</code>；</p>
<p><code>Schedulers.newThread()</code>：为每个工作单元创建一个新的线程；</p>
<p><code>Schedulers.test()</code>：用于测试目的，支持单元测试的高级事件；</p>
<p><code>Schedulers.trampoline()</code>：在当前线程中的工作放入队列中排队，并依次操作。</p>
<p>通过设置<code>observeOn</code>和<code>subscribeOn</code>调度器，我们定义了网络请求使用哪个线程（<code>Schedulers.newThread()</code>）。</p>
<p>来源：<a href="https://asce1885.gitbooks.io/android-rd-senior-advanced/content/" target="_blank" rel="external">https://asce1885.gitbooks.io/android-rd-senior-advanced/content/</a></p>
<p>学习资料：<a href="http://www.jianshu.com/p/f5dab35986c4" target="_blank" rel="external">http://www.jianshu.com/p/f5dab35986c4</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/23/java-invoke/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/23/java-invoke/" itemprop="url">
                  Java反射之Method.invoke
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-23 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-23T23:47:44+08:00">2017-10-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 11:46:25" itemprop="dateModified" datetime="2017-11-11T11:46:25+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="JAVA反射机制"><a href="#JAVA反射机制" class="headerlink" title="JAVA反射机制"></a>JAVA反射机制</h3><p>JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。</p>
<p>Java反射机制主要提供了以下功能： 在运行时判断任意一个对象所属的类；在运行时构造任意一个类的对象；在运行时判断任意一个类所具有的成员变量和方法；在运行时调用任意一个对象的方法；生成动态代理。</p>
<h3 id="1-得到某个对象的属性"><a href="#1-得到某个对象的属性" class="headerlink" title="1. 得到某个对象的属性"></a>1. 得到某个对象的属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getProperty</span><span class="params">(Object owner, String fieldName)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">     Class ownerClass = owner.getClass();  </span><br><span class="line">   </span><br><span class="line">     Field field = ownerClass.getField(fieldName);  </span><br><span class="line">   </span><br><span class="line">     Object property = field.get(owner);  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> property;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Class ownerClass = owner.getClass()：得到该对象的Class。<br>Field field = ownerClass.getField(fieldName)：通过Class得到类声明的属性。<br>Object property = field.get(owner)：通过对象得到该属性的实例，如果这个属性是非公有的，这里会报IllegalAccessException。</p>
<h3 id="2-得到某个类的静态属性"><a href="#2-得到某个类的静态属性" class="headerlink" title="2. 得到某个类的静态属性"></a>2. 得到某个类的静态属性</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getStaticProperty</span><span class="params">(String className, String fieldName)</span>  </span></span><br><span class="line"><span class="function">             <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">     Class ownerClass = Class.forName(className);  </span><br><span class="line">   </span><br><span class="line">     Field field = ownerClass.getField(fieldName);  </span><br><span class="line">   </span><br><span class="line">     Object property = field.get(ownerClass);  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> property;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Class ownerClass = Class.forName(className) ：首先得到这个类的Class。<br>Field field = ownerClass.getField(fieldName)：和上面一样，通过Class得到类声明的属性。<br>Object property = field.get(ownerClass) ：这里和上面有些不同，因为该属性是静态的，所以直接从类的Class里取。</p>
<h3 id="3-执行某对象的方法"><a href="#3-执行某对象的方法" class="headerlink" title="3. 执行某对象的方法"></a>3. 执行某对象的方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invokeMethod</span><span class="params">(Object owner, String methodName, Object[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">   </span><br><span class="line">     Class ownerClass = owner.getClass();  </span><br><span class="line">   </span><br><span class="line">     Class[] argsClass = <span class="keyword">new</span> Class[args.length];  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = args.length; i &lt; j; i++) &#123;  </span><br><span class="line">         argsClass[i] = args[i].getClass();  </span><br><span class="line">     &#125;  </span><br><span class="line">  </span><br><span class="line">      Method method = ownerClass.getMethod(methodName,argsClass);  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> method.invoke(owner, args);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Class owner_class = owner.getClass() ：首先还是必须得到这个对象的Class。<br><strong>5～9行：配置参数的Class数组，作为寻找Method的条件</strong>。<br>Method method = ownerClass.getMethod(methodName, argsClass)：通过methodName和参数的argsClass（方法中的参数类型集合）数组得到要执行的Method。<br>method.invoke(owner, args)：执行该Method.invoke方法的参数是执行这个方法的对象owner，和参数数组args，可以这么理解：owner对象中带有参数args的method方法。返回值是Object，也既是该方法的返回值。</p>
<h3 id="4-执行某个类的静态方法"><a href="#4-执行某个类的静态方法" class="headerlink" title="4. 执行某个类的静态方法"></a>4. 执行某个类的静态方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invokeStaticMethod</span><span class="params">(String className, String methodName,  </span></span></span><br><span class="line"><span class="function"><span class="params">             Object[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">     Class ownerClass = Class.forName(className);  </span><br><span class="line">   </span><br><span class="line">     Class[] argsClass = <span class="keyword">new</span> Class[args.length];  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = args.length; i &lt; j; i++) &#123;  </span><br><span class="line">         argsClass[i] = args[i].getClass();  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">    Method method = ownerClass.getMethod(methodName,argsClass);  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> method.invoke(<span class="keyword">null</span>, args);  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>基本的原理和实例3相同，不同点是最后一行，invoke的一个参数是null，因为这是静态方法，不需要借助实例运行。</p>
<h3 id="5-新建实例"><a href="#5-新建实例" class="headerlink" title="5. 新建实例"></a>5. 新建实例</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">newInstance</span><span class="params">(String className, Object[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;  </span><br><span class="line">     Class newoneClass = Class.forName(className);  </span><br><span class="line">   </span><br><span class="line">     Class[] argsClass = <span class="keyword">new</span> Class[args.length];  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = args.length; i &lt; j; i++) &#123;  </span><br><span class="line">         argsClass[i] = args[i].getClass();  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     Constructor cons = newoneClass.getConstructor(argsClass);  </span><br><span class="line">   </span><br><span class="line">     <span class="keyword">return</span> cons.newInstance(args);  </span><br><span class="line">   </span><br><span class="line">&#125;  </span><br><span class="line">``` </span><br><span class="line">这里说的方法是执行带参数的构造函数来新建实例的方法。如果不需要参数，可以直接使用newoneClass.newInstance()来实现。  </span><br><span class="line">Class newoneClass = Class.forName(className)：第一步，得到要构造的实例的Class。  </span><br><span class="line">**第<span class="number">5</span>～第<span class="number">9</span>行：得到参数的Class数组**。  </span><br><span class="line">Constructor cons = newoneClass.getConstructor(argsClass)：得到构造子。  </span><br><span class="line">cons.newInstance(args)：新建实例。</span><br><span class="line"></span><br><span class="line">### 6. 判断是否为某个类的实例</span><br><span class="line">```java</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInstance</span><span class="params">(Object obj, Class cls)</span> </span>&#123;  </span><br><span class="line">     <span class="keyword">return</span> cls.isInstance(obj);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>得到数组中的某个元素</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getByArray</span><span class="params">(Object array, <span class="keyword">int</span> index)</span> </span>&#123;  </span><br><span class="line">     <span class="keyword">return</span> Array.get(array,index);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来源：<a href="http://blog.csdn.net/mr_tim/article/details/51594717" target="_blank" rel="external">http://blog.csdn.net/mr_tim/article/details/51594717</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/21/xmlns/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/xmlns/" itemprop="url">
                  关于XML文档的xmlns、xsi和schemaLocation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-21 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-21T23:47:44+08:00">2017-10-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 11:26:15" itemprop="dateModified" datetime="2017-11-11T11:26:15+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>摘要</strong>： 相信很多人和我一样，在编写Spring或者Maven或者其他需要用到XML文档的程序时，通常都是将这些XML文档头拷贝过来，并没有理解其中元素（比如xmlns，xmlns:xsi，xsi:schemaLocation）的真正含义，不知道哪些元素是多余的，也不知道为什么要加那些元素。这样当有时候网上Copy的XML头有错的时候自己却不知道怎么下手。我也是这样的，于是今天花了点时间好好的理解了一下这些元素及其用法，现整理与此，在此谢谢各位前辈的经验，如有总结的不对或者不好的地方，欢迎留言提出各位的宝贵意见。</p>
<p>话不多说，先来一段Spring的XML样本，相信大家都很眼熟：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context </span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">                           http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"xxx.xxx.controller"</span> /&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">"/images/**"</span> <span class="attr">location</span>=<span class="string">"/images/"</span> /&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"xxx"</span> <span class="attr">class</span>=<span class="string">"xxx.xxx.xxx.Xxx"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxxx"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个文档中，根元素<code>&lt;beans/&gt;</code>就不用说了，接下来是xmlns。那么什么是xmlns呢？xmlns其实是XML Namespace的缩写，可译为“XML命名空间”，但个人觉得，翻译后的名字反而不好理解，所以我们就叫它为XML Namespace吧。</p>
<h3 id="为什么需要xmlns？"><a href="#为什么需要xmlns？" class="headerlink" title="为什么需要xmlns？"></a>为什么需要xmlns？</h3><p>考虑这样两个XML文档：表示HTML表格元素的<code>&lt;table/&gt;</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Apples<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span>Bananas<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>和描述一张桌子的<code>&lt;table/&gt;</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>African Coffee Table<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">width</span>&gt;</span>80<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">length</span>&gt;</span>120<span class="tag">&lt;/<span class="name">length</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>假如这两个 XML 文档被一起使用，由于两个文档都包含带有不同内容和定义的 <code>&lt;table&gt;</code>元素，就会发生命名冲突。XML 解析器是无法确定如何处理这类冲突。为了解决上述问题，xmlns就产生了。</p>
<h3 id="如何使用xmlns？"><a href="#如何使用xmlns？" class="headerlink" title="如何使用xmlns？"></a>如何使用xmlns？</h3><p>很简单，使用语法： xmlns:namespace-prefix=”namespaceURI”。其中namespace-prefix为自定义前缀，只要在这个XML文档中保证前缀不重复即可；namespaceURI是这个前缀对应的XML Namespace的定义。例如，</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:context="http://www.springframework.org/schema/context"</span><br></pre></td></tr></table></figure>
<p>这一句定义了一个 <a href="http://www.springframwork.org/schema/context的Namespace" target="_blank" rel="external">http://www.springframwork.org/schema/context的Namespace</a> （这和Java类中的包的声明很相似），并将其和前缀context绑定。所以上面的Spring XML文档中会有这么一句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"xxx.xxx.controller"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的<code>&lt;component-scan/&gt;</code>元素就来自别名为context的XML Namespace，也就是在 <a href="http://www.springframework.org/schema/context中定义的" target="_blank" rel="external">http://www.springframework.org/schema/context中定义的</a> 。</p>
<p>我们还可以将前缀定义为abc：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:abc="namespaceURI"</span><br></pre></td></tr></table></figure>
<p>这样再使用这个namespaceURI中的元素时，需要以abc为前缀，例如：<code>&lt;abc:xxx/&gt;</code>。再拿上面的例子解释怎么使用xmlns：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里xmlns:h="url1"表示这个table是用h作为标记，table的写法在url1中定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h:table</span> <span class="attr">xmlns:h</span>=<span class="string">"url1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h:tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h:td</span>&gt;</span>Apples<span class="tag">&lt;/<span class="name">h:td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h:td</span>&gt;</span>Bananas<span class="tag">&lt;/<span class="name">h:td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">h:tr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h:table</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>和：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里xmlns:f="url2"表示这个table是用f作为标记，table的写法在url2中定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">f:table</span> <span class="attr">xmlns:f</span>=<span class="string">"url2"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">f:name</span>&gt;</span>African Coffee Table<span class="tag">&lt;/<span class="name">f:name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">f:width</span>&gt;</span>80<span class="tag">&lt;/<span class="name">f:width</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">f:length</span>&gt;</span>120<span class="tag">&lt;/<span class="name">f:length</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">f:table</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>后者与前者仅仅使用不同前缀，我们为<code>&lt;table&gt;</code>标签添加了一个 xmlns 属性，这样就为前缀赋予了一个与某个命名空间相关联的限定名称。此时再把它们放在一起，XML解析器就不会报错了。</p>
<p>注意：当xmlns被定义在元素的开始标签中（如这里的<code>&lt;f:table/&gt;</code>）时，所有带有相同前缀的子元素都会与同一个Namespace相关联（即里面的<code>&lt;f:name/&gt;</code>和<code>&lt;f:width/&gt;</code>也会使用url2定义的写法）。</p>
<h3 id="xmlns和xmlns-xsi有什么不同？"><a href="#xmlns和xmlns-xsi有什么不同？" class="headerlink" title="xmlns和xmlns:xsi有什么不同？"></a>xmlns和xmlns:xsi有什么不同？</h3><p>xmlns表示默认的Namespace。例如Spring XML文档中的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns="http://www.springframework.org/schema/beans"</span><br></pre></td></tr></table></figure>
<p>这一句表示该文档默认的XML Namespace为 <a href="http://www.springframwork.org/schema/beans" target="_blank" rel="external">http://www.springframwork.org/schema/beans</a> 。对于默认的Namespace中的元素，可以不使用前缀。例如Spring XML文档中的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"xxx"</span> <span class="attr">class</span>=<span class="string">"xxx.xxx.xxx.Xxx"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"xxx"</span> <span class="attr">value</span>=<span class="string">"xxxx"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>xmlns:xsi表示使用xsi作为前缀的Namespace，当然前缀xsi需要在文档中声明。</p>
<h3 id="xsi-schemaLocation有何作用？"><a href="#xsi-schemaLocation有何作用？" class="headerlink" title="xsi:schemaLocation有何作用？"></a>xsi:schemaLocation有何作用？</h3><p>xsi:schemaLocation属性其实是Namespace为 <a href="http://www.w3.org/2001/XMLSchema-instance" target="_blank" rel="external">http://www.w3.org/2001/XMLSchema-instance</a> 里的schemaLocation属性，正是因为我们一开始声明了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span><br></pre></td></tr></table></figure>
<p>这里才写作xsi:schemaLocation（当然一般都使用这个前缀）。它定义了XML Namespace和对应的XSD（Xml Schema Definition）文档的位置的关系。它的值由一个或多个URI引用对组成，两个URI之间以空白符分隔（空格和换行均可）。第一个URI是定义的XML Namespace的值，第二个URI给出Schema文档的位置，Schema处理器将从这个位置读取Schema文档，该文档的targetNamespace必须与第一个URI相匹配。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xsi:schemaLocation="http://www.springframework.org/schema/context </span><br><span class="line">http://www.springframework.org/schema/context/spring-context.xsd"</span><br></pre></td></tr></table></figure>
<p>这里表示Namespace为<br><a href="http://www.springframework.org/schema/context的Schema" target="_blank" rel="external">http://www.springframework.org/schema/context的Schema</a> 的位置为 <a href="http://www.springframework.org/schema/context/spring-context.xsd" target="_blank" rel="external">http://www.springframework.org/schema/context/spring-context.xsd</a> 。这里我们可以打开这个Schema的位置，下面是这个文档的开始部分：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xsd:schema</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsd</span>=<span class="string">"http://www.w3.org/2001/XMLSchema"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:beans</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tool</span>=<span class="string">"http://www.springframework.org/schema/tool"</span></span></span><br><span class="line">    &lt;!-- 这里的targetNamespace和上方xsi:schemaLocation中的第一个URI匹配 --&gt; </span><br><span class="line">    targetNamespace="http://www.springframework.org/schema/context"</span><br><span class="line">    elementFormDefault="qualified"</span><br><span class="line">    attributeFormDefault="unqualified"&gt;</span><br></pre></td></tr></table></figure>
<p>有了上面的说明后，再去理解开始的Spring XML文档，一定会有不一样的感觉！</p>
<p>来源：<a href="https://yq.aliyun.com/articles/40353" target="_blank" rel="external">https://yq.aliyun.com/articles/40353</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/21/cms-design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/21/cms-design/" itemprop="url">
                  CMS之数据库设计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-21 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-21T23:47:44+08:00">2017-10-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 11:29:43" itemprop="dateModified" datetime="2017-11-11T11:29:43+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>首先是了解需求。一个网站会有什么？首页、新闻（图文形式的信息）、产品介绍、文件下载、图片浏览、在线视频等。这些都算是“内容”的几种形式吧，当然还可以有其他的形式。</p>
<p>这个需求比较简单，也比较简陋，暂时就以这个需求来进行设计吧。如果是按照面向对象的方式要如何设计呢？这个我不太清楚，也许是要画一个UML吧，也许要建模。尝试一下，画了一个UML不知道对不对，拿出来请大家批批。</p>
<p>【CMS的类图】<img src="/2017/10/21/cms-design/1.gif" alt=""></p>
<p>图很简单也没什么具体的属性，因为需求是变化的，现在也没有太具体的需求，所以属性就先设置几个主要的。另外俺英文不好，怕查出来的英文单词不正确产生歧义，所以直接用汉字了。可能您看着很别扭，但是至少不会产生什么歧义，理解起来也会比较容易吧，呵呵。</p>
<p>“内容”作为父类，其他的作为子类。内容是一种“抽象”，把各种形式的内容的共同部分提炼出来，比如标题、内容、添加人、添加日期、点击量等。子类负责各自特有的属性。</p>
<p>我觉得这种提炼的方式比较好，在设计数据库表结构的时候可以借鉴一下。于是就有了这样的数据库设计。</p>
<p>【CMS ER图】<img src="/2017/10/21/cms-design/2.jpg" alt=""></p>
<h4 id="建议：文章分成两个表，一个表只包含-id-和-content，一个表包含其他字段，如标题，日期，作者，类别等等"><a href="#建议：文章分成两个表，一个表只包含-id-和-content，一个表包含其他字段，如标题，日期，作者，类别等等" class="headerlink" title="建议：文章分成两个表，一个表只包含 id 和 content，一个表包含其他字段，如标题，日期，作者，类别等等"></a>建议：文章分成两个表，一个表只包含 id 和 content，一个表包含其他字段，如标题，日期，作者，类别等等</h4><p>“内容”作为主体和中心，其他的都是为了这个中心（内容）来服务的。左面是对内容的限制，栏目相当于大分类，分类就是小分类（可以是n级的），类型就是内容的形式，比如图文、下载、视频、图片等。右面是扩展。扩展和类型是一一对应的。</p>
<p>这就形成了一个“骨架”，骨架是以“内容”为中心，ArticleID作为关联字段，可以增加扩展表，但是都要以ArticleID作为关联字段。至于有多少扩展表，那就可以根据实际需求来变化，表里的字段也是可以根据需求来增减。</p>
<p>设置这种“骨架”的好处：虽然扩展表、字段会有变化，但是“骨架”结构是不变的。这样一是可以让结构清晰，抓住中心、重点；二是当需求变化的时候，对结构的影响降到最低；三是，如果对于这种“骨架”习惯、掌握了之后，在看到其他项目的设计就会很容易进入和读懂。关于第三点，以后大家就会理解的。</p>
<p>基本思路就是这样，抛砖引玉了。</p>
<p>ps：CMS的字段说明</p>
<p><img src="/2017/10/21/cms-design/3.png" alt=""></p>
<p><img src="/2017/10/21/cms-design/4.png" alt=""></p>
<p>来源：<a href="http://blog.csdn.net/jyk/article/details/5537089" target="_blank" rel="external">http://blog.csdn.net/jyk/article/details/5537089</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://51codes.top/2017/10/20/freemarker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Codes Online">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/20/freemarker/" itemprop="url">
                  页面静态化-Freemarker模板引擎
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2017-10-20 23:47:44" itemprop="dateCreated datePublished" datetime="2017-10-20T23:47:44+08:00">2017-10-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-11-11 11:19:44" itemprop="dateModified" datetime="2017-11-11T11:19:44+08:00">2017-11-11</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Spring-Cloud/" itemprop="url" rel="index"><span itemprop="name">Spring Cloud</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、FreeMarker简介"><a href="#一、FreeMarker简介" class="headerlink" title="一、FreeMarker简介"></a>一、FreeMarker简介</h3><h3 id="1、动态网页和静态网页差异"><a href="#1、动态网页和静态网页差异" class="headerlink" title="1、动态网页和静态网页差异"></a>1、动态网页和静态网页差异</h3><p>在进入主题之前我先介绍一下什么是动态网页，动态网页是指跟静态网页相对应的一种网页编程技术。静态网页，随着HTML代码的生成，页面的内容和显示效 果就不会再发生变化(除非你修改页面代码)。而动态网页则不然，页面代码虽然没有发生变化，但是显示的内容却是可以随着时间、环境或者数据库操作的结果而 发生相应的变化。简而言之，动态网页是基本的HTML语法规范与java、VB、VC等高级程序设计语言、数据库编程等多种技术的融合，以实现对网站内容 和风格的高效、动态和交互式的管理。</p>
<p>通过前面的介绍我们可以得出动态网页和静态网页的优缺点(这里我们只考虑网站性能方面的相关问题，信息安全等多方面问题不做赘述)：</p>
<h4 id="1-静态网页："><a href="#1-静态网页：" class="headerlink" title="1)静态网页："></a>1)静态网页：</h4><p>　　a、静态网页的内容稳定，页面加载速度快。</p>
<p>　　b、静态网页的没有数据库支持，在网站制作和维护方面的工作量较大。</p>
<p>　　c、静态网页的交互性差，有很大的局限性。</p>
<h4 id="2-动态网页："><a href="#2-动态网页：" class="headerlink" title="2)动态网页："></a>2)动态网页：</h4><p>　　a、交互性好。</p>
<p>　　b、动态网页的信息都需要从数据库中读取，每打开一个一面就需要去获取一次数据库，如果访问人数很多，也就会对服务器增加很大的荷载，从而影响这个网站的运行速度。</p>
<p>　 　通过上面的比较我们不难看出，要提升网站的性能，我们只要把动态网页做成静态网页就会在运行速度方面有显著的提升，但是问题出来了，如果将所有页面都做 成静态页面显然是不切实际的。有什么办法能让我们的网站即能有动态网页的交互性，又有静态网页的加载速度呢?FreeMarker便能实现这样的需求：实 现动态网页静态化。</p>
<h3 id="2、FreeMarker原理"><a href="#2、FreeMarker原理" class="headerlink" title="2、FreeMarker原理"></a>2、FreeMarker原理</h3><p>　　FreeMarker是一个基 于Java的开发包和类库的一种将模板和数据进行整合并输出文本的通用工具，FreeMarker实现页面静态化的原理是：将页面中所需要的样式写入到 FreeMarker模板文件中，然后将页面所需要的数据进行动态绑定并放入到Map中，然后通过FreeMarker的模板解析类process()方 法完成静态页面的生成。其工作原理如图2-1所示。</p>
<p><img src="/2017/10/20/freemarker/1.jpg" alt=""></p>
<p>模板 + 数据模型 = 输出</p>
<h3 id="二、-示例演示FreeMarker"><a href="#二、-示例演示FreeMarker" class="headerlink" title="二、 示例演示FreeMarker"></a>二、 示例演示FreeMarker</h3><p>先看一下Demo项目的整体结构:</p>
<p><img src="/2017/10/20/freemarker/2.png" alt=""></p>
<p>上面我们已经说了, 模板 + 数据模型 = 输出, 那么我们就一个个看模板和数据模型是什么样子的, 以及最后的输出是什么样子的.</p>
<p>注: 这里将省略freemarker的语法, 因为很多都是类似EL表达式的, 这里只提供几种情况的讲解, 其中包括: list, map, list和map混合<br>FMDemo.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FMDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Freemarker</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        <span class="comment">//模板+数据模型 = 输出</span></span><br><span class="line">        <span class="comment">//ftl: freemarker template</span></span><br><span class="line">        <span class="comment">//第一步: 读取html模板</span></span><br><span class="line">        String dir = <span class="string">"C:\\workspace\\freemarker\\ftl\\"</span>;</span><br><span class="line">        conf.setDirectoryForTemplateLoading(<span class="keyword">new</span> File(dir));</span><br><span class="line">        Template template = conf.getTemplate(<span class="string">"freemarker.html"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//第二步: 加载数据模型</span></span><br><span class="line">        Map root = <span class="keyword">new</span> HashMap();</span><br><span class="line">        root.put(<span class="string">"world"</span>, <span class="string">"世界你好"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//List集合</span></span><br><span class="line">        List&lt;String&gt; persons = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        persons.add(<span class="string">"范冰冰"</span>);</span><br><span class="line">        persons.add(<span class="string">"李冰冰"</span>);</span><br><span class="line">        persons.add(<span class="string">"何炅"</span>);</span><br><span class="line">        root.put(<span class="string">"persons"</span>, persons);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Map集合</span></span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        map.put(<span class="string">"fbb"</span>, <span class="string">"范冰冰"</span>);</span><br><span class="line">        map.put(<span class="string">"lbb"</span>, <span class="string">"李冰冰"</span>);</span><br><span class="line">        root.put(<span class="string">"map"</span>, map);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//list和map混合</span></span><br><span class="line">        List&lt;Map&gt; maps = <span class="keyword">new</span> ArrayList&lt;Map&gt;();</span><br><span class="line">        Map pms1 = <span class="keyword">new</span> HashMap();</span><br><span class="line">        pms1.put(<span class="string">"id1"</span>, <span class="string">"范冰冰"</span>);</span><br><span class="line">        pms1.put(<span class="string">"id2"</span>, <span class="string">"李冰冰"</span>);</span><br><span class="line">        Map pms2 = <span class="keyword">new</span> HashMap();</span><br><span class="line">        pms2.put(<span class="string">"id1"</span>, <span class="string">"曾志伟"</span>);</span><br><span class="line">        pms2.put(<span class="string">"id2"</span>, <span class="string">"何炅"</span>);</span><br><span class="line">        maps.add(pms1);</span><br><span class="line">        maps.add(pms2);</span><br><span class="line">        root.put(<span class="string">"maps"</span>, maps);</span><br><span class="line">        </span><br><span class="line">        Writer out = <span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(dir + <span class="string">"hello.html"</span>));</span><br><span class="line">        template.process(root, out);</span><br><span class="line">        System.out.println(<span class="string">"生成完成"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>freemarker.html: 模板文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">$&#123;world&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">persons</span> <span class="attr">as</span> <span class="attr">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#if</span> <span class="attr">person_index</span> == <span class="string">2</span>&gt;</span></span><br><span class="line">        $&#123;person&#125;---红色</span><br><span class="line">    <span class="tag">&lt;<span class="name">#else</span>&gt;</span></span><br><span class="line">        $&#123;person&#125;---绿色</span><br><span class="line">    <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">map</span>?<span class="attr">keys</span> <span class="attr">as</span> <span class="attr">key</span>&gt;</span></span><br><span class="line">    $&#123;map[key]&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line">$&#123;map.fbb&#125;/$&#123;map.lbb&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">maps</span> <span class="attr">as</span> <span class="attr">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#list</span> <span class="attr">map</span>?<span class="attr">keys</span> <span class="attr">as</span> <span class="attr">key</span>&gt;</span></span><br><span class="line">        $&#123;map[key]&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">maps</span> <span class="attr">as</span> <span class="attr">map</span>&gt;</span></span><br><span class="line">    $&#123;map.id1&#125;///$&#123;map.id2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行FMDemo.java中的Main方法, 这会生成:</p>
<p><img src="/2017/10/20/freemarker/3.png" alt=""></p>
<p>hello.html:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">世界你好</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        范冰冰---绿色</span><br><span class="line">        李冰冰---绿色</span><br><span class="line">        何炅---红色</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    李冰冰</span><br><span class="line">    范冰冰</span><br><span class="line">范冰冰/李冰冰<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        李冰冰</span><br><span class="line">        范冰冰</span><br><span class="line">        何炅</span><br><span class="line">        曾志伟</span><br><span class="line">    范冰冰///李冰冰</span><br><span class="line">    曾志伟///何炅</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="三、-静态化页面在项目中的使用"><a href="#三、-静态化页面在项目中的使用" class="headerlink" title="三、 静态化页面在项目中的使用"></a>三、 静态化页面在项目中的使用</h3><p>这里就来说下静态化页面在项目中的使用情况, 现在只是给商品详情页做了静态化处理.</p>
<p>前面关于ActiveMQ的文章已经说过, 当一个商品上架的时候, 通过发送消息来通知babasport-cms 来将对应的页面静态化.</p>
<p>在这里我们只写接收消息的方法, 首先来看看babasport-cms的结构图:<br>CustomMessageListener.java:接收MQ中的消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StaticPageService staticPageService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CMSService cmsService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//先将接收到的消息强转为ActiveMQ类型的消息</span></span><br><span class="line">        <span class="comment">//因为在消息发送方那边传递的是Text类型的消息对象, 所以需要转成ActiveMQTextMessage</span></span><br><span class="line">        ActiveMQTextMessage amtm = (ActiveMQTextMessage)message;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String id = amtm.getText();</span><br><span class="line">            System.out.println(<span class="string">"CMS接收到的ID:"</span>+id);</span><br><span class="line">            Map&lt;String, Object&gt; root = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">            </span><br><span class="line">            Product product = cmsService.selectProductById(Long.parseLong(id));</span><br><span class="line">            List&lt;Sku&gt; skus = cmsService.selectSkuListByProductIdWithStock(Long.parseLong(id));</span><br><span class="line">            <span class="comment">//去掉重复的颜色</span></span><br><span class="line">            Set&lt;Color&gt; colors = <span class="keyword">new</span> HashSet&lt;Color&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Sku sku : skus) &#123;</span><br><span class="line">                colors.add(sku.getColor());</span><br><span class="line">            &#125;</span><br><span class="line">            root.put(<span class="string">"colors"</span>, colors);</span><br><span class="line">            root.put(<span class="string">"product"</span>, product);</span><br><span class="line">            root.put(<span class="string">"skus"</span>, skus);</span><br><span class="line">            </span><br><span class="line">            staticPageService.index(root, id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>StaticPageServiceImpl.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticPageServiceImpl</span> <span class="keyword">implements</span> <span class="title">StaticPageService</span>, <span class="title">ServletContextAware</span></span>&#123;</span><br><span class="line">    <span class="comment">//SpringMvc 管理 conf</span></span><br><span class="line">    <span class="keyword">private</span> Configuration conf;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFreeMarkerConfig</span><span class="params">(FreeMarkerConfig freeMarkerConfig)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.conf = freeMarkerConfig.getConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//静态化页面的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(Map&lt;String, Object&gt; root, String id)</span></span>&#123;</span><br><span class="line">        <span class="comment">//输出目录: 通过getPath方法获取的是绝对路径</span></span><br><span class="line">        String path = getPath(<span class="string">"/html/product/"</span> + id +<span class="string">".html"</span>);</span><br><span class="line">        File f = <span class="keyword">new</span> File(path);</span><br><span class="line">        File parentFile = f.getParentFile();</span><br><span class="line">        <span class="keyword">if</span>(!parentFile.exists())&#123;</span><br><span class="line">            parentFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//spring中已经设置了模板路径:&lt;property name="templateLoaderPath" value="/WEB-INF/ftl/" /&gt;</span></span><br><span class="line">        Writer out = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//读</span></span><br><span class="line">            Template template = conf.getTemplate(<span class="string">"product.html"</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//设置输出的位置</span></span><br><span class="line">            <span class="comment">//写</span></span><br><span class="line">            out = <span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(f), <span class="string">"UTF-8"</span>);</span><br><span class="line">            template.process(root, out);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取webapp下的html文件夹所在的位置</span></span><br><span class="line">    <span class="comment">//将相对路径转换为绝对路径</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPath</span><span class="params">(String path)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> servletContext.getRealPath(path);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ServletContext servletContext;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.servletContext = servletContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用Spring管理Freemarker配置文件:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置freemarker 实现类 --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.itcast.core.service.StaticPageServiceImpl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"freeMarkerConfig"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 设置模板所在目录或文件夹的位置, 相对路径  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateLoaderPath"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/ftl/"</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 设置默认编码集 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>模板页面: product.html 中的改动:</p>
<p>引入其他页面:</p>
<p>&lt;#include “commons/header.html” /&gt;</p>
<p>循环遍历colors:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dd"</span> <span class="attr">id</span>=<span class="string">"colors"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#list</span> <span class="attr">colors</span> <span class="attr">as</span> <span class="attr">color</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">onclick</span>=<span class="string">"colorToRed(this,'$&#123;color.id&#125;')"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">title</span>=<span class="string">"$&#123;color.name &#125;"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-img</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"/images/53f44cc2N0b714cb2_002.jpg"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">alt</span>=<span class="string">"灰色三件套"</span> <span class="attr">height</span>=<span class="string">"25"</span> <span class="attr">width</span>=<span class="string">"25"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>$&#123;color.name &#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>循环遍历imgUrls, 并且使用if..else 进行判断:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spec-items"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"lh"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#list</span> <span class="attr">product.imgUrls</span> <span class="attr">as</span> <span class="attr">pic</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">#if</span> <span class="attr">pic_index</span> == <span class="string">0</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-img</span>=<span class="string">"1"</span> <span class="attr">class</span>=<span class="string">"img-hover"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">alt</span>=<span class="string">"$&#123;product.name&#125;"</span> <span class="attr">src</span>=<span class="string">"$&#123;pic&#125;"</span> <span class="attr">width</span>=<span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">#else</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-img</span>=<span class="string">"1"</span> <span class="attr">alt</span>=<span class="string">"$&#123;product.name&#125;"</span> <span class="attr">src</span>=<span class="string">"$&#123;pic&#125;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">width</span>=<span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span> &gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其他的照常使用EL表达式, 然后生成 id.html的静态化页面, 查看访问后的页面:</p>
<p><img src="/2017/10/20/freemarker/4.png" alt=""></p>
<p>关于Freemarker简单的讲解差不多就是这样, 还没有其他高深的理解, 相信技术都是慢慢积累的, 先入门再深入. 本博客会永久更新, 我相信我会一直坚持下来的.</p>
<p>来源：<a href="http://www.cnblogs.com/wang-meng/p/5840281.html" target="_blank" rel="external">http://www.cnblogs.com/wang-meng/p/5840281.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">107</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">18</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.4.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
