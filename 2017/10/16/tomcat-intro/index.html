<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Tomcat工作原理 | Codes Online</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Tomcat工作原理</h1><a id="logo" href="/.">Codes Online</a><p class="description">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _enjoying</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Tomcat工作原理</h1><div class="post-meta">Oct 16, 2017<span> | </span><span class="category"><a href="/categories/Java/">Java</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><p>基于Java的Web 应用程序是 servlet、JSP 页面、静态页面、类和其他资源的集合，它们可以用标准方式打包，并运行在来自多个供应商的多个容器。Web 应用程序存在于结构化层次结构的目录中，该层次结构是由 Java Servlet 规范定义的。Web 应用程序的根目录包含直接存储或存储在子文件夹中的所有公共资源，比如图像、HTML 页面等。构成：Web应用由Web组件(一组Java类库)、html文件，静态资源文件（如图像）、帮助类和库组成。</p>
<h3 id="1-–-Tomcat-Server的组成部分"><a href="#1-–-Tomcat-Server的组成部分" class="headerlink" title="1 – Tomcat Server的组成部分"></a>1 – Tomcat Server的组成部分</h3><h3 id="1-1-–-Server"><a href="#1-1-–-Server" class="headerlink" title="1.1 – Server"></a>1.1 – Server</h3><p>A Server element represents the entire Catalina servlet container. (Singleton)</p>
<h3 id="1-2-–-Service"><a href="#1-2-–-Service" class="headerlink" title="1.2 – Service"></a>1.2 – Service</h3><p>A Service element represents the combination of one or more Connector components that share a single Engine</p>
<p>Service是这样一个集合：它由一个或者多个Connector组成，以及一个Engine，负责处理所有Connector所获得的客户请求</p>
<h3 id="1-3-–-Connector"><a href="#1-3-–-Connector" class="headerlink" title="1.3 – Connector"></a>1.3 – Connector</h3><p>一个Connector将在某个指定端口上侦听客户请求，并将获得的请求交给Engine来处理，从Engine处获得回应并返回客户</p>
<p>TOMCAT有两个典型的Connector，一个直接侦听来自browser的http请求，一个侦听来自其它WebServer的请求</p>
<p>Coyote Http/1.1 Connector 在端口8080处侦听来自客户browser的http请求</p>
<p>Coyote JK2 Connector 在端口8009处侦听来自其它WebServer(Apache)的servlet/jsp代理请求</p>
<h3 id="1-4-–-Engine"><a href="#1-4-–-Engine" class="headerlink" title="1.4 – Engine"></a>1.4 – Engine</h3><p>The Engine element represents the entire request processing machinery associated with a particular Service<br>It receives and processes all requests from one or more Connectors<br>and returns the completed response to the Connector for ultimate transmission back to the client</p>
<p>Engine下可以配置多个虚拟主机Virtual Host，每个虚拟主机都有一个域名<br>当Engine获得一个请求时，它把该请求匹配到某个Host上，然后把该请求交给该Host来处理</p>
<p>Engine有一个默认虚拟主机，当请求无法匹配到任何一个Host上的时候，将交给该默认Host来处理</p>
<h3 id="1-5-–-Host"><a href="#1-5-–-Host" class="headerlink" title="1.5 – Host"></a>1.5 – Host</h3><p>代表一个Virtual Host，虚拟主机，每个虚拟主机和某个网络域名Domain Name相匹配</p>
<p>每个虚拟主机下都可以部署(deploy)一个或者多个Web App，每个Web App对应于一个Context，有一个Context path</p>
<p>当Host获得一个请求时，将把该请求匹配到某个Context上，然后把该请求交给该Context来处理</p>
<p>匹配的方法是“最长匹配”，所以一个path==””的Context将成为该Host的默认Context</p>
<p>所有无法和其它Context的路径名匹配的请求都将最终和该默认Context匹配</p>
<h3 id="1-6-–-Context"><a href="#1-6-–-Context" class="headerlink" title="1.6 – Context"></a>1.6 – Context</h3><p>一个Context对应于一个Web Application，一个Web Application由一个或者多个Servlet组成</p>
<p>Context在创建的时候将根据配置文件$CATALINA_HOME/conf/web.xml和$WEBAPP_HOME/WEB-INF/web.xml载入Servlet类</p>
<p>当Context获得请求时，将在自己的映射表(mapping table)中寻找相匹配的Servlet类</p>
<p>如果找到，则执行该类，获得请求的回应，并返回</p>
<h3 id="2-–-Tomcat-Server的结构图"><a href="#2-–-Tomcat-Server的结构图" class="headerlink" title="2 – Tomcat Server的结构图"></a>2 – Tomcat Server的结构图</h3><p><img src="/2017/10/16/tomcat-intro/1.png" alt=""></p>
<h3 id="3-–-配置文件-CATALINA-HOME-conf-server-xml的说明"><a href="#3-–-配置文件-CATALINA-HOME-conf-server-xml的说明" class="headerlink" title="3 – 配置文件$CATALINA_HOME/conf/server.xml的说明"></a>3 – 配置文件$CATALINA_HOME/conf/server.xml的说明</h3><p>该文件描述了如何启动Tomcat Server</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-----------------------------------------------------------------------------------------------&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 启动Server 在端口8005处等待关闭命令 如果接受到"SHUTDOWN"字符串则关闭服务器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8005"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span> <span class="attr">debug</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Listener ??? 目前没有看到这里 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.mbeans.ServerLifecycleListener"</span> <span class="attr">debug</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Listener</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> <span class="attr">debug</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Global JNDI resources ??? 目前没有看到这里，先略去 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line"> ... ... ... ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">GlobalNamingResources</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Tomcat的Standalone Service Service是一组Connector的集合 它们共用一个Engine来处理所有Connector收到的请求 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Service</span> <span class="attr">name</span>=<span class="string">"Tomcat-Standalone"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Coyote HTTP/1.1 Connector className : 该Connector的实现类是org.apache.coyote.tomcat4.CoyoteConnector port :</span></span><br><span class="line"><span class="comment">在端口号8080处侦听来自客户browser的HTTP1.1请求 minProcessors : 该Connector先创建5个线程等待客户请求，</span></span><br><span class="line"><span class="comment">每个请求由一个线程负责 maxProcessors : 当现有的线程不够服务客户请求时，若线程总数不足75个，则创建新线程来处理请求</span></span><br><span class="line"><span class="comment">acceptCount : 当现有线程已经达到最大数75时，为客户请求排队 当队列中请求数超过100时，后来的请求返回Connection refused</span></span><br><span class="line"><span class="comment">错误 redirectport : 当客户请求是https时，把该请求转发到端口8443去 其它属性略 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">className</span>=<span class="string">"org.apache.coyote.tomcat4.CoyoteConnector"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">port</span>=<span class="string">"8080"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">minProcessors</span>=<span class="string">"5"</span> <span class="attr">maxProcessors</span>=<span class="string">"75"</span> <span class="attr">acceptCount</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">enableLookups</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">redirectPort</span>=<span class="string">"8443"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">debug</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">useURIValidationHack</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag"> <span class="attr">disableUploadTimeout</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Engine用来处理Connector收到的Http请求 它将匹配请求和自己的虚拟主机，</span></span><br><span class="line"><span class="comment">并把请求转交给对应的Host来处理默认虚拟主机是localhost --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Engine</span> <span class="attr">name</span>=<span class="string">"Standalone"</span> <span class="attr">defaultHost</span>=<span class="string">"localhost"</span> <span class="attr">debug</span>=<span class="string">"0"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 日志类，目前没有看到，略去先 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Logger</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.logger.FileLogger"</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Realm，目前没有看到，略去先 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Realm</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.realm.UserDatabaseRealm"</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 虚拟主机localhost appBase : 该虚拟主机的根目录是webapps/ 它将匹配请求和</span></span><br><span class="line"><span class="comment">自己的Context的路径，并把请求转交给对应的Context来处理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">name</span>=<span class="string">"localhost"</span> <span class="attr">debug</span>=<span class="string">"0"</span> <span class="attr">appBase</span>=<span class="string">"webapps"</span> <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 日志类，目前没有看到，略去先 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Logger</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.logger.FileLogger"</span> <span class="attr">...</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Context，对应于一个Web App path : 该Context的路径名是""，故该Context是该Host的</span></span><br><span class="line"><span class="comment">默认Context docBase : 该Context的根目录是webapps/mycontext/ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">docBase</span>=<span class="string">"mycontext"</span> <span class="attr">debug</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 另外一个Context，路径名是/wsota --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/wsota"</span> <span class="attr">docBase</span>=<span class="string">"wsotaProject"</span> <span class="attr">debug</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Engine</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Service</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Server</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-----------------------------------------------------------------------------------------------&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4-–-Context的部署配置文件web-xml的说明"><a href="#4-–-Context的部署配置文件web-xml的说明" class="headerlink" title="4 – Context的部署配置文件web.xml的说明"></a>4 – Context的部署配置文件web.xml的说明</h3><p>一个Context对应于一个Web App，每个Web App是由一个或者多个servlet组成的</p>
<p>当一个Web App被初始化的时候，它将用自己的ClassLoader对象载入“部署配置文件web.xml”中定义的每个servlet类</p>
<p>它首先载入在$CATALINA_HOME/conf/web.xml中部署的servlet类</p>
<p>然后载入在自己的Web App根目录下的WEB-INF/web.xml中部署的servlet类<br>web.xml文件有两部分：servlet类定义和servlet映射定义</p>
<p>每个被载入的servlet类都有一个名字，且被填入该Context的映射表(mapping table)中，和某种URL PATTERN对应</p>
<p>当该Context获得请求时，将查询mapping table，找到被请求的servlet，并执行以获得请求回应</p>
<p>分析一下所有的Context共享的web.xml文件，在其中定义的servlet被所有的Web App载入</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-----------------------------------------------------------------------------------------------&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 概述： 该文件是所有的WEB APP共用的部署配置文件， 每当一个WEB APP</span></span><br><span class="line"><span class="comment">被DEPLOY，该文件都将先被处理，然后才是WEB APP自己的/WEB-INF/web.xml --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- +-------------------------+ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- | servlet类定义部分 | --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- +-------------------------+ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- DefaultServlet</span></span><br><span class="line"><span class="comment">当用户的HTTP请求无法匹配任何一个servlet的时候，该servlet被执行</span></span><br><span class="line"><span class="comment">URL PATTERN MAPPING : / --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">org.apache.catalina.servlets.DefaultServlet</span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>listings<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- InvokerServlet</span></span><br><span class="line"><span class="comment">处理一个WEB APP中的匿名servlet 当一个servlet被编写并编译放入</span></span><br><span class="line"><span class="comment">/WEB-INF/classes/中，却没有在/WEB-INF/web.xml中定义的时候</span></span><br><span class="line"><span class="comment">该servlet被调用，把匿名servlet映射成/servlet/ClassName的形式</span></span><br><span class="line"><span class="comment">URL PATTERN MAPPING : /servlet/* --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>invoker<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.catalina.servlets.InvokerServlet <span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>debug<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>0<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>2<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- JspServlet</span></span><br><span class="line"><span class="comment">当请求的是一个JSP页面的时候（*.jsp）该servlet被调用</span></span><br><span class="line"><span class="comment">它是一个JSP编译器，将请求的JSP页面编译成为servlet再执行</span></span><br><span class="line"><span class="comment">URL PATTERN MAPPING : *.jsp --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.apache.jasper.servlet.JspServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>logVerbosityLevel<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>WARNING<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>3<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- +---------------------------+ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- | servlet映射定义部分 | --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- +---------------------------+ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>default<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>invoker<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/servlet/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>jsp<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.jsp<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- +------------------------+ --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- | 其它部分，略去先 | --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- +------------------------+ --&gt;</span></span><br><span class="line">... ... ... ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-----------------------------------------------------------------------------------------------&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-–-Tomcat-Server处理一个http请求的过程"><a href="#5-–-Tomcat-Server处理一个http请求的过程" class="headerlink" title="5 – Tomcat Server处理一个http请求的过程"></a>5 – Tomcat Server处理一个http请求的过程</h3><p>假设来自客户的请求为：</p>
<p><a href="http://localhost:8080/wsota/wsota_index.jsp" target="_blank" rel="external">http://localhost:8080/wsota/wsota_index.jsp</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1) 请求被发送到本机端口8080，被在那里侦听的Coyote HTTP/1.1 Connector获得</span><br><span class="line">2) Connector把该请求交给它所在的Service的Engine来处理，并等待来自Engine的回应</span><br><span class="line">3) Engine获得请求localhost/wsota/wsota_index.jsp，匹配它所拥有的所有虚拟主机Host</span><br><span class="line">4) Engine匹配到名为localhost的Host（即使匹配不到也把请求交给该Host处理，因为该Host被定义为该Engine的默认主机）</span><br><span class="line">5) localhost Host获得请求/wsota/wsota_index.jsp，匹配它所拥有的所有Context</span><br><span class="line">6) Host匹配到路径为/wsota的Context（如果匹配不到就把该请求交给路径名为”&quot;的Context去处理）</span><br><span class="line">7) path=”/wsota”的Context获得请求/wsota_index.jsp，在它的mapping table中寻找对应的servlet</span><br><span class="line">8) Context匹配到URL PATTERN为*.jsp的servlet，对应于JspServlet类</span><br><span class="line">9) 构造HttpServletRequest对象和HttpServletResponse对象，作为参数调用JspServlet的doGet或doPost方法</span><br><span class="line">10)Context把执行完了之后的HttpServletResponse对象返回给Host</span><br><span class="line">11)Host把HttpServletResponse对象返回给Engine</span><br><span class="line">12)Engine把HttpServletResponse对象返回给Connector</span><br><span class="line">13)Connector把HttpServletResponse对象返回给客户browser</span><br></pre></td></tr></table></figure>
<p>来源：<a href="http://www.cnblogs.com/boblogsbo/p/5207205.html" target="_blank" rel="external">http://www.cnblogs.com/boblogsbo/p/5207205.html</a></p>
<hr>
<h2 id="tomcat配置多个虚拟主机"><a href="#tomcat配置多个虚拟主机" class="headerlink" title="tomcat配置多个虚拟主机"></a>tomcat配置多个虚拟主机</h2><p>先修改默认端口（8080），http的默认端口是80，我们将8080改成80，这样域名就不用带上端口了</p>
<p>修改conf文件夹下的server.xml文件</p>
<p>添加多个主机(以下三个主机对应三个域名，三个域名对应同一个ip地址)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"D:"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"wap.test.com"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span> <span class="attr">xmlValidation</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"D:\wap"</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> <span class="attr">crossContext</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"D:"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"web.test.com"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span> <span class="attr">xmlValidation</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"D:\web"</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> <span class="attr">crossContext</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"><span class="tag">&lt;<span class="name">Host</span> <span class="attr">appBase</span>=<span class="string">"D:"</span> <span class="attr">autoDeploy</span>=<span class="string">"true"</span> <span class="attr">name</span>=<span class="string">"manage.test.com"</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">unpackWARs</span>=<span class="string">"true"</span> <span class="attr">xmlNamespaceAware</span>=<span class="string">"false"</span> <span class="attr">xmlValidation</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Context</span> <span class="attr">docBase</span>=<span class="string">"D:\manage"</span> <span class="attr">path</span>=<span class="string">""</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> <span class="attr">crossContext</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Host</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;host&gt;</code>中的元素：appBase–&gt;项目文件夹的父目录 name–&gt;该主机对应的域名，其他元素自己百度</p>
<p><code>&lt;context&gt;</code>中的元素：docBase–&gt;对应项目文件夹或者项目的.war包（如果是war包，就需要把unpackWARs设置为true）</p>
<p>path–&gt;访问时如果要带上项目名就添加项目名，不需要（直接域名访问）就为空。</p>
<p>我们在windows中测试：修改C:\Windows\System32\drivers\etc下的hosts文件。添加三个模拟的域名<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1       wap.test.com</span><br><span class="line">127.0.0.1       web.test.com</span><br><span class="line">127.0.0.1       manage.test.com</span><br></pre></td></tr></table></figure></p>
<p>三个域名对应的是同一个ip地址，即本地的ip地址。</p>
<p>来源: <a href="http://www.cnblogs.com/LvLoveYuForever/p/5886788.html" target="_blank" rel="external">http://www.cnblogs.com/LvLoveYuForever/p/5886788.html</a></p>
</div><div class="tags"></div><div class="post-nav"><a href="/2017/10/19/hive-hbase/" class="pre">Hbase和Hive的差别</a><a href="/2017/10/16/spring-web-xml/" class="next">web.xml中定义的Spring的XML配置文件启动顺序</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenCV/">OpenCV</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/嵌入式/">嵌入式</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/环境搭建/">环境搭建</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/行业/">行业</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.linkedkeeper.com/" title="张松然" target="_blank">张松然</a><ul></ul><a href="http://weishu.me/" title="维术" target="_blank">维术</a><ul></ul><a href="http://zhixinliu.com/" title="Zhixin Liu" target="_blank">Zhixin Liu</a><ul></ul><a href="http://www.ruanyifeng.com/" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.tianmaying.com/user/luoruici" title="Ricky" target="_blank">Ricky</a><ul></ul><a href="http://jeffdeng.me/" title="荒于嬉" target="_blank">荒于嬉</a><ul></ul><a href="https://kcaogen.com/blog" title="康草根" target="_blank">康草根</a><ul></ul><a href="http://13blog.site/" title="zhenfeng13" target="_blank">zhenfeng13</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Codes Online.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>