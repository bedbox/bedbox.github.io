<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>页面静态化-Freemarker模板引擎 | Codes Online</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">页面静态化-Freemarker模板引擎</h1><a id="logo" href="/.">Codes Online</a><p class="description">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _enjoying</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">页面静态化-Freemarker模板引擎</h1><div class="post-meta">Oct 20, 2017<span> | </span><span class="category"><a href="/categories/Spring-Cloud/">Spring Cloud</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><h3 id="一、FreeMarker简介"><a href="#一、FreeMarker简介" class="headerlink" title="一、FreeMarker简介"></a>一、FreeMarker简介</h3><h3 id="1、动态网页和静态网页差异"><a href="#1、动态网页和静态网页差异" class="headerlink" title="1、动态网页和静态网页差异"></a>1、动态网页和静态网页差异</h3><p>在进入主题之前我先介绍一下什么是动态网页，动态网页是指跟静态网页相对应的一种网页编程技术。静态网页，随着HTML代码的生成，页面的内容和显示效 果就不会再发生变化(除非你修改页面代码)。而动态网页则不然，页面代码虽然没有发生变化，但是显示的内容却是可以随着时间、环境或者数据库操作的结果而 发生相应的变化。简而言之，动态网页是基本的HTML语法规范与java、VB、VC等高级程序设计语言、数据库编程等多种技术的融合，以实现对网站内容 和风格的高效、动态和交互式的管理。</p>
<p>通过前面的介绍我们可以得出动态网页和静态网页的优缺点(这里我们只考虑网站性能方面的相关问题，信息安全等多方面问题不做赘述)：</p>
<h4 id="1-静态网页："><a href="#1-静态网页：" class="headerlink" title="1)静态网页："></a>1)静态网页：</h4><p>　　a、静态网页的内容稳定，页面加载速度快。</p>
<p>　　b、静态网页的没有数据库支持，在网站制作和维护方面的工作量较大。</p>
<p>　　c、静态网页的交互性差，有很大的局限性。</p>
<h4 id="2-动态网页："><a href="#2-动态网页：" class="headerlink" title="2)动态网页："></a>2)动态网页：</h4><p>　　a、交互性好。</p>
<p>　　b、动态网页的信息都需要从数据库中读取，每打开一个一面就需要去获取一次数据库，如果访问人数很多，也就会对服务器增加很大的荷载，从而影响这个网站的运行速度。</p>
<p>　 　通过上面的比较我们不难看出，要提升网站的性能，我们只要把动态网页做成静态网页就会在运行速度方面有显著的提升，但是问题出来了，如果将所有页面都做 成静态页面显然是不切实际的。有什么办法能让我们的网站即能有动态网页的交互性，又有静态网页的加载速度呢?FreeMarker便能实现这样的需求：实 现动态网页静态化。</p>
<h3 id="2、FreeMarker原理"><a href="#2、FreeMarker原理" class="headerlink" title="2、FreeMarker原理"></a>2、FreeMarker原理</h3><p>　　FreeMarker是一个基 于Java的开发包和类库的一种将模板和数据进行整合并输出文本的通用工具，FreeMarker实现页面静态化的原理是：将页面中所需要的样式写入到 FreeMarker模板文件中，然后将页面所需要的数据进行动态绑定并放入到Map中，然后通过FreeMarker的模板解析类process()方 法完成静态页面的生成。其工作原理如图2-1所示。</p>
<p><img src="/2017/10/20/freemarker/1.jpg" alt=""></p>
<p>模板 + 数据模型 = 输出</p>
<h3 id="二、-示例演示FreeMarker"><a href="#二、-示例演示FreeMarker" class="headerlink" title="二、 示例演示FreeMarker"></a>二、 示例演示FreeMarker</h3><p>先看一下Demo项目的整体结构:</p>
<p><img src="/2017/10/20/freemarker/2.png" alt=""></p>
<p>上面我们已经说了, 模板 + 数据模型 = 输出, 那么我们就一个个看模板和数据模型是什么样子的, 以及最后的输出是什么样子的.</p>
<p>注: 这里将省略freemarker的语法, 因为很多都是类似EL表达式的, 这里只提供几种情况的讲解, 其中包括: list, map, list和map混合<br>FMDemo.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FMDemo</span> </span>&#123;</span><br><span class="line">    <span class="comment">//Freemarker</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        </span><br><span class="line">        Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        <span class="comment">//模板+数据模型 = 输出</span></span><br><span class="line">        <span class="comment">//ftl: freemarker template</span></span><br><span class="line">        <span class="comment">//第一步: 读取html模板</span></span><br><span class="line">        String dir = <span class="string">"C:\\workspace\\freemarker\\ftl\\"</span>;</span><br><span class="line">        conf.setDirectoryForTemplateLoading(<span class="keyword">new</span> File(dir));</span><br><span class="line">        Template template = conf.getTemplate(<span class="string">"freemarker.html"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//第二步: 加载数据模型</span></span><br><span class="line">        Map root = <span class="keyword">new</span> HashMap();</span><br><span class="line">        root.put(<span class="string">"world"</span>, <span class="string">"世界你好"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//List集合</span></span><br><span class="line">        List&lt;String&gt; persons = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        persons.add(<span class="string">"范冰冰"</span>);</span><br><span class="line">        persons.add(<span class="string">"李冰冰"</span>);</span><br><span class="line">        persons.add(<span class="string">"何炅"</span>);</span><br><span class="line">        root.put(<span class="string">"persons"</span>, persons);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//Map集合</span></span><br><span class="line">        Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">        map.put(<span class="string">"fbb"</span>, <span class="string">"范冰冰"</span>);</span><br><span class="line">        map.put(<span class="string">"lbb"</span>, <span class="string">"李冰冰"</span>);</span><br><span class="line">        root.put(<span class="string">"map"</span>, map);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//list和map混合</span></span><br><span class="line">        List&lt;Map&gt; maps = <span class="keyword">new</span> ArrayList&lt;Map&gt;();</span><br><span class="line">        Map pms1 = <span class="keyword">new</span> HashMap();</span><br><span class="line">        pms1.put(<span class="string">"id1"</span>, <span class="string">"范冰冰"</span>);</span><br><span class="line">        pms1.put(<span class="string">"id2"</span>, <span class="string">"李冰冰"</span>);</span><br><span class="line">        Map pms2 = <span class="keyword">new</span> HashMap();</span><br><span class="line">        pms2.put(<span class="string">"id1"</span>, <span class="string">"曾志伟"</span>);</span><br><span class="line">        pms2.put(<span class="string">"id2"</span>, <span class="string">"何炅"</span>);</span><br><span class="line">        maps.add(pms1);</span><br><span class="line">        maps.add(pms2);</span><br><span class="line">        root.put(<span class="string">"maps"</span>, maps);</span><br><span class="line">        </span><br><span class="line">        Writer out = <span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(dir + <span class="string">"hello.html"</span>));</span><br><span class="line">        template.process(root, out);</span><br><span class="line">        System.out.println(<span class="string">"生成完成"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>freemarker.html: 模板文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">$&#123;world&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">persons</span> <span class="attr">as</span> <span class="attr">person</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#if</span> <span class="attr">person_index</span> == <span class="string">2</span>&gt;</span></span><br><span class="line">        $&#123;person&#125;---红色</span><br><span class="line">    <span class="tag">&lt;<span class="name">#else</span>&gt;</span></span><br><span class="line">        $&#123;person&#125;---绿色</span><br><span class="line">    <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">map</span>?<span class="attr">keys</span> <span class="attr">as</span> <span class="attr">key</span>&gt;</span></span><br><span class="line">    $&#123;map[key]&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line">$&#123;map.fbb&#125;/$&#123;map.lbb&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">maps</span> <span class="attr">as</span> <span class="attr">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#list</span> <span class="attr">map</span>?<span class="attr">keys</span> <span class="attr">as</span> <span class="attr">key</span>&gt;</span></span><br><span class="line">        $&#123;map[key]&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">#list</span> <span class="attr">maps</span> <span class="attr">as</span> <span class="attr">map</span>&gt;</span></span><br><span class="line">    $&#123;map.id1&#125;///$&#123;map.id2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>执行FMDemo.java中的Main方法, 这会生成:</p>
<p><img src="/2017/10/20/freemarker/3.png" alt=""></p>
<p>hello.html:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Insert title here<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">世界你好</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        范冰冰---绿色</span><br><span class="line">        李冰冰---绿色</span><br><span class="line">        何炅---红色</span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    李冰冰</span><br><span class="line">    范冰冰</span><br><span class="line">范冰冰/李冰冰<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        李冰冰</span><br><span class="line">        范冰冰</span><br><span class="line">        何炅</span><br><span class="line">        曾志伟</span><br><span class="line">    范冰冰///李冰冰</span><br><span class="line">    曾志伟///何炅</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="三、-静态化页面在项目中的使用"><a href="#三、-静态化页面在项目中的使用" class="headerlink" title="三、 静态化页面在项目中的使用"></a>三、 静态化页面在项目中的使用</h3><p>这里就来说下静态化页面在项目中的使用情况, 现在只是给商品详情页做了静态化处理.</p>
<p>前面关于ActiveMQ的文章已经说过, 当一个商品上架的时候, 通过发送消息来通知babasport-cms 来将对应的页面静态化.</p>
<p>在这里我们只写接收消息的方法, 首先来看看babasport-cms的结构图:<br>CustomMessageListener.java:接收MQ中的消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomMessageListener</span> <span class="keyword">implements</span> <span class="title">MessageListener</span></span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StaticPageService staticPageService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CMSService cmsService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(Message message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//先将接收到的消息强转为ActiveMQ类型的消息</span></span><br><span class="line">        <span class="comment">//因为在消息发送方那边传递的是Text类型的消息对象, 所以需要转成ActiveMQTextMessage</span></span><br><span class="line">        ActiveMQTextMessage amtm = (ActiveMQTextMessage)message;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String id = amtm.getText();</span><br><span class="line">            System.out.println(<span class="string">"CMS接收到的ID:"</span>+id);</span><br><span class="line">            Map&lt;String, Object&gt; root = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">            </span><br><span class="line">            Product product = cmsService.selectProductById(Long.parseLong(id));</span><br><span class="line">            List&lt;Sku&gt; skus = cmsService.selectSkuListByProductIdWithStock(Long.parseLong(id));</span><br><span class="line">            <span class="comment">//去掉重复的颜色</span></span><br><span class="line">            Set&lt;Color&gt; colors = <span class="keyword">new</span> HashSet&lt;Color&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Sku sku : skus) &#123;</span><br><span class="line">                colors.add(sku.getColor());</span><br><span class="line">            &#125;</span><br><span class="line">            root.put(<span class="string">"colors"</span>, colors);</span><br><span class="line">            root.put(<span class="string">"product"</span>, product);</span><br><span class="line">            root.put(<span class="string">"skus"</span>, skus);</span><br><span class="line">            </span><br><span class="line">            staticPageService.index(root, id);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (JMSException e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>StaticPageServiceImpl.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticPageServiceImpl</span> <span class="keyword">implements</span> <span class="title">StaticPageService</span>, <span class="title">ServletContextAware</span></span>&#123;</span><br><span class="line">    <span class="comment">//SpringMvc 管理 conf</span></span><br><span class="line">    <span class="keyword">private</span> Configuration conf;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFreeMarkerConfig</span><span class="params">(FreeMarkerConfig freeMarkerConfig)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.conf = freeMarkerConfig.getConfiguration();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//静态化页面的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">index</span><span class="params">(Map&lt;String, Object&gt; root, String id)</span></span>&#123;</span><br><span class="line">        <span class="comment">//输出目录: 通过getPath方法获取的是绝对路径</span></span><br><span class="line">        String path = getPath(<span class="string">"/html/product/"</span> + id +<span class="string">".html"</span>);</span><br><span class="line">        File f = <span class="keyword">new</span> File(path);</span><br><span class="line">        File parentFile = f.getParentFile();</span><br><span class="line">        <span class="keyword">if</span>(!parentFile.exists())&#123;</span><br><span class="line">            parentFile.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//spring中已经设置了模板路径:&lt;property name="templateLoaderPath" value="/WEB-INF/ftl/" /&gt;</span></span><br><span class="line">        Writer out = <span class="keyword">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//读</span></span><br><span class="line">            Template template = conf.getTemplate(<span class="string">"product.html"</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//设置输出的位置</span></span><br><span class="line">            <span class="comment">//写</span></span><br><span class="line">            out = <span class="keyword">new</span> OutputStreamWriter(<span class="keyword">new</span> FileOutputStream(f), <span class="string">"UTF-8"</span>);</span><br><span class="line">            template.process(root, out);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="keyword">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取webapp下的html文件夹所在的位置</span></span><br><span class="line">    <span class="comment">//将相对路径转换为绝对路径</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPath</span><span class="params">(String path)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> servletContext.getRealPath(path);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> ServletContext servletContext;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServletContext</span><span class="params">(ServletContext servletContext)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.servletContext = servletContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用Spring管理Freemarker配置文件:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 配置freemarker 实现类 --&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"cn.itcast.core.service.StaticPageServiceImpl"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"freeMarkerConfig"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 设置模板所在目录或文件夹的位置, 相对路径  --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"templateLoaderPath"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/ftl/"</span> /&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 设置默认编码集 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultEncoding"</span> <span class="attr">value</span>=<span class="string">"UTF-8"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>模板页面: product.html 中的改动:</p>
<p>引入其他页面:</p>
<p>&lt;#include “commons/header.html” /&gt;</p>
<p>循环遍历colors:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"dd"</span> <span class="attr">id</span>=<span class="string">"colors"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">#list</span> <span class="attr">colors</span> <span class="attr">as</span> <span class="attr">color</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span> <span class="attr">onclick</span>=<span class="string">"colorToRed(this,'$&#123;color.id&#125;')"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:;"</span> <span class="attr">title</span>=<span class="string">"$&#123;color.name &#125;"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">data-img</span>=<span class="string">"1"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"/images/53f44cc2N0b714cb2_002.jpg"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">alt</span>=<span class="string">"灰色三件套"</span> <span class="attr">height</span>=<span class="string">"25"</span> <span class="attr">width</span>=<span class="string">"25"</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>$&#123;color.name &#125;<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>循环遍历imgUrls, 并且使用if..else 进行判断:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"spec-items"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"lh"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">#list</span> <span class="attr">product.imgUrls</span> <span class="attr">as</span> <span class="attr">pic</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">#if</span> <span class="attr">pic_index</span> == <span class="string">0</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-img</span>=<span class="string">"1"</span> <span class="attr">class</span>=<span class="string">"img-hover"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">alt</span>=<span class="string">"$&#123;product.name&#125;"</span> <span class="attr">src</span>=<span class="string">"$&#123;pic&#125;"</span> <span class="attr">width</span>=<span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">#else</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">data-img</span>=<span class="string">"1"</span> <span class="attr">alt</span>=<span class="string">"$&#123;product.name&#125;"</span> <span class="attr">src</span>=<span class="string">"$&#123;pic&#125;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">width</span>=<span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span> &gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">#if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">#list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其他的照常使用EL表达式, 然后生成 id.html的静态化页面, 查看访问后的页面:</p>
<p><img src="/2017/10/20/freemarker/4.png" alt=""></p>
<p>关于Freemarker简单的讲解差不多就是这样, 还没有其他高深的理解, 相信技术都是慢慢积累的, 先入门再深入. 本博客会永久更新, 我相信我会一直坚持下来的.</p>
<p>来源：<a href="http://www.cnblogs.com/wang-meng/p/5840281.html" target="_blank" rel="external">http://www.cnblogs.com/wang-meng/p/5840281.html</a></p>
</div><div class="tags"></div><div class="post-nav"><a href="/2017/10/21/xmlns/" class="pre">关于XML文档的xmlns、xsi和schemaLocation</a><a href="/2017/10/20/ssm-study/" class="next">SSM教程</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Node-js/">Node.js</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Cloud/">Spring Cloud</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web/">Web</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/嵌入式/">嵌入式</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/环境搭建/">环境搭建</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://weishu.me/" title="维术" target="_blank">维术</a><ul></ul><a href="http://zhixinliu.com/" title="Zhixin Liu" target="_blank">Zhixin Liu</a><ul></ul><a href="http://www.ruanyifeng.com/" title="阮一峰" target="_blank">阮一峰</a><ul></ul><a href="https://www.tianmaying.com/user/luoruici" title="Ricky" target="_blank">Ricky</a><ul></ul><a href="http://jeffdeng.me/" title="荒于嬉" target="_blank">荒于嬉</a><ul></ul><a href="https://kcaogen.com/blog" title="康草根" target="_blank">康草根</a><ul></ul><a href="http://13blog.site/" title="zhenfeng13" target="_blank">zhenfeng13</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Codes Online.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>